


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > HospitalApp</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.example.hospitalsystemgpt.gui</a>
</div>

<h1>Coverage Summary for Class: HospitalApp (com.example.hospitalsystemgpt.gui)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">HospitalApp</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/98)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/216)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/938)
  </span>
</td>
</tr>
  <tr>
    <td class="name">HospitalApp$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/25)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">HospitalApp$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/25)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">HospitalApp$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/15)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">HospitalApp$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">HospitalApp$5</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/24)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">HospitalApp$6</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">HospitalApp$7</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/112)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/270)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1057)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.example.hospitalsystemgpt.gui;
&nbsp;
&nbsp;import com.example.hospitalsystemgpt.*;
&nbsp;import javafx.application.Application;
&nbsp;import javafx.beans.property.SimpleDoubleProperty;
&nbsp;import javafx.beans.property.SimpleIntegerProperty;
&nbsp;import javafx.beans.property.SimpleStringProperty;
&nbsp;import javafx.collections.FXCollections;
&nbsp;import javafx.collections.ObservableList;
&nbsp;import javafx.geometry.Insets;
&nbsp;import javafx.geometry.Pos;
&nbsp;import javafx.scene.Node;
&nbsp;import javafx.scene.Scene;
&nbsp;import javafx.scene.control.*;
&nbsp;import javafx.scene.control.cell.PropertyValueFactory;
&nbsp;import javafx.scene.layout.HBox;
&nbsp;import javafx.scene.layout.Priority;
&nbsp;import javafx.scene.layout.Region;
&nbsp;import javafx.scene.layout.VBox;
&nbsp;import javafx.stage.Modality;
&nbsp;import javafx.stage.Stage;
&nbsp;import java.time.LocalDate;
&nbsp;import java.time.LocalDateTime;
&nbsp;import java.time.LocalTime;
&nbsp;import java.util.List;
&nbsp;import java.util.Optional;
&nbsp;import java.util.stream.Collectors;
&nbsp;
<b class="nc">&nbsp;public class HospitalApp extends Application {</b>
&nbsp;    // --- Backend Services ---
<b class="nc">&nbsp;    private final PatientService patientService = new PatientServiceImpl();</b>
<b class="nc">&nbsp;    private final AppointmentService appointmentService = new AppointmentServiceImpl();</b>
<b class="nc">&nbsp;    private final MedicalRecordService medicalRecordService = new MedicalRecordServiceImpl();</b>
<b class="nc">&nbsp;    private final BillingService billingService = new BillingServiceImpl();</b>
<b class="nc">&nbsp;    private final InventoryService inventoryService = new InventoryServiceImpl();</b>
&nbsp;
&nbsp;    // --- Controller ---
<b class="nc">&nbsp;    private final HospitalController controller = new HospitalController(</b>
&nbsp;            patientService, appointmentService, medicalRecordService, billingService, inventoryService
&nbsp;    );
&nbsp;
&nbsp;    // --- Observable Lists for TableViews ---
<b class="nc">&nbsp;    private final ObservableList&lt;Patient&gt; patientList = FXCollections.observableArrayList();</b>
<b class="nc">&nbsp;    private final ObservableList&lt;Appointment&gt; appointmentList = FXCollections.observableArrayList();</b>
<b class="nc">&nbsp;    private final ObservableList&lt;MedicalRecord&gt; recordList = FXCollections.observableArrayList();</b>
<b class="nc">&nbsp;    private final ObservableList&lt;Bill&gt; billList = FXCollections.observableArrayList();</b>
<b class="nc">&nbsp;    private final ObservableList&lt;InventoryItem&gt; inventoryList = FXCollections.observableArrayList();</b>
&nbsp;
&nbsp;    // --- Constants ---
&nbsp;    private static final String BUTTON_STYLE_PRIMARY = &quot;-fx-background-color: #222; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 8 24 8 24; -fx-font-size: 15px; -fx-background-radius: 8;&quot;;
&nbsp;    private static final String BUTTON_STYLE_VIEW = &quot;-fx-background-color: #fff; -fx-border-color: #bbb; -fx-border-radius: 4; -fx-background-radius: 4;&quot;;
&nbsp;    private static final String BUTTON_STYLE_EDIT = &quot;-fx-background-color: #eef; -fx-border-color: #99f; -fx-border-radius: 4; -fx-background-radius: 4;&quot;;
&nbsp;    private static final String BUTTON_STYLE_DELETE = &quot;-fx-background-color: #fee; -fx-border-color: #f99; -fx-border-radius: 4; -fx-background-radius: 4;&quot;;
&nbsp;    private static final String BUTTON_STYLE_ACTION1 = &quot;-fx-background-color: #e0ffe0; -fx-border-color: #8f8; -fx-border-radius: 4; -fx-background-radius: 4;&quot;; // Greenish (Admit, Complete)
&nbsp;    private static final String BUTTON_STYLE_ACTION2 = &quot;-fx-background-color: #e0e0ff; -fx-border-color: #99f; -fx-border-radius: 4; -fx-background-radius: 4;&quot;; // Bluish (Discharge, Cancel)
&nbsp;    private static final String BUTTON_STYLE_ACTION3 = &quot;-fx-background-color: #fff0e0; -fx-border-color: #f90; -fx-border-radius: 4; -fx-background-radius: 4;&quot;; // Orangish (Mark Paid)
&nbsp;
&nbsp;    //Entry point for the JavaFX application. Shows the role selection screen where the user chooses Doctor or Admin.
&nbsp;    @Override
&nbsp;    public void start(Stage primaryStage) {
<b class="nc">&nbsp;        Label prompt = new Label(&quot;Are you a Doctor or an Admin?&quot;);</b>
<b class="nc">&nbsp;        Button doctorBtn = new Button(&quot;Doctor&quot;);</b>
<b class="nc">&nbsp;        Button adminBtn = new Button(&quot;Admin&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        doctorBtn.setOnAction(e -&gt; showDashboard(primaryStage, &quot;Doctor&quot;));</b>
<b class="nc">&nbsp;        adminBtn.setOnAction(e -&gt; showDashboard(primaryStage, &quot;Admin&quot;));</b>
&nbsp;
<b class="nc">&nbsp;        VBox root = new VBox(15, prompt, doctorBtn, adminBtn);</b>
<b class="nc">&nbsp;        root.setStyle(&quot;-fx-alignment: center; -fx-padding: 40;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        Scene scene = new Scene(root, 300, 180);</b>
<b class="nc">&nbsp;        primaryStage.setTitle(&quot;Hospital System - Role Selection&quot;);</b>
<b class="nc">&nbsp;        primaryStage.setScene(scene);</b>
<b class="nc">&nbsp;        primaryStage.show();</b>
&nbsp;    }
&nbsp;
&nbsp;    /* Displays the dashboard for the selected role (Doctor or Admin).
&nbsp;     Shows relevant feature buttons and a logout button to return to the start page.*/
&nbsp;    private void showDashboard(Stage stage, String role) {
<b class="nc">&nbsp;        Label dashLabel = new Label(role + &quot; Dashboard&quot;);</b>
<b class="nc">&nbsp;        dashLabel.setStyle(&quot;-fx-font-size: 20px; -fx-font-weight: bold;&quot;);</b>
<b class="nc">&nbsp;        Button patientBtn = new Button(&quot;Patient Management&quot;);</b>
<b class="nc">&nbsp;        Button apptBtn = new Button(&quot;Appointment Scheduling&quot;);</b>
<b class="nc">&nbsp;        Button recordBtn = new Button(&quot;Medical Records&quot;);</b>
<b class="nc">&nbsp;        Button billingBtn = new Button(&quot;Billing&quot;);</b>
<b class="nc">&nbsp;        Button inventoryBtn = new Button(&quot;Inventory&quot;);</b>
<b class="nc">&nbsp;        Button logoutBtn = new Button(&quot;Logout&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        String dashButtonStyle = &quot;-fx-min-width: 200px; -fx-padding: 10px; -fx-font-size: 14px;&quot;;</b>
<b class="nc">&nbsp;        patientBtn.setStyle(dashButtonStyle);</b>
<b class="nc">&nbsp;        apptBtn.setStyle(dashButtonStyle);</b>
<b class="nc">&nbsp;        recordBtn.setStyle(dashButtonStyle);</b>
<b class="nc">&nbsp;        billingBtn.setStyle(dashButtonStyle);</b>
<b class="nc">&nbsp;        inventoryBtn.setStyle(dashButtonStyle);</b>
<b class="nc">&nbsp;        logoutBtn.setStyle(&quot;-fx-min-width: 100px; -fx-padding: 8px;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        patientBtn.setOnAction(e -&gt; showPatientManagement(stage, role));</b>
<b class="nc">&nbsp;        apptBtn.setOnAction(e -&gt; showAppointmentScheduling(stage, role));</b>
<b class="nc">&nbsp;        recordBtn.setOnAction(e -&gt; showMedicalRecords(stage, role));</b>
<b class="nc">&nbsp;        billingBtn.setOnAction(e -&gt; showBilling(stage, role));</b>
<b class="nc">&nbsp;        inventoryBtn.setOnAction(e -&gt; showInventory(stage, role));</b>
<b class="nc">&nbsp;        logoutBtn.setOnAction(e -&gt; start(stage));</b>
&nbsp;
&nbsp;        VBox dash;
<b class="nc">&nbsp;        if (role.equals(&quot;Admin&quot;)) {</b>
<b class="nc">&nbsp;            dash = new VBox(12, dashLabel, billingBtn, inventoryBtn, logoutBtn);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            dash = new VBox(12, dashLabel, patientBtn, apptBtn, recordBtn, logoutBtn);</b>
&nbsp;        }
<b class="nc">&nbsp;        dash.setStyle(&quot;-fx-alignment: center; -fx-padding: 40; -fx-background-color: #f0f0f0;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        stage.setTitle(&quot;Hospital System - &quot; + role + &quot; Dashboard&quot;);</b>
<b class="nc">&nbsp;        stage.setScene(new Scene(dash, 400, 350));</b>
&nbsp;    }
&nbsp;
&nbsp;    // --- Common UI Building Blocks ---
&nbsp;
&nbsp;    private HBox createTopBar(String title, Stage stage, String role) {
<b class="nc">&nbsp;        Button backBtn = new Button(&quot;Back&quot;);</b>
<b class="nc">&nbsp;        Label titleLabel = new Label(title);</b>
<b class="nc">&nbsp;        backBtn.setOnAction(e -&gt; showDashboard(stage, role));</b>
<b class="nc">&nbsp;        backBtn.setTooltip(new Tooltip(&quot;Return to dashboard&quot;));</b>
<b class="nc">&nbsp;        titleLabel.setStyle(&quot;-fx-font-size: 22px; -fx-font-weight: bold;&quot;);</b>
<b class="nc">&nbsp;        HBox topBar = new HBox(10, backBtn, titleLabel);</b>
<b class="nc">&nbsp;        topBar.setAlignment(Pos.CENTER_LEFT);</b>
<b class="nc">&nbsp;        topBar.setPadding(new Insets(0, 0, 10, 0));</b>
<b class="nc">&nbsp;        return topBar;</b>
&nbsp;    }
&nbsp;
&nbsp;    private HBox createSearchAddBar(String searchPrompt, String addTooltip, javafx.event.EventHandler&lt;javafx.event.ActionEvent&gt; addAction) {
<b class="nc">&nbsp;        TextField searchField = new TextField();</b>
<b class="nc">&nbsp;        searchField.setPromptText(searchPrompt);</b>
<b class="nc">&nbsp;        searchField.setMinWidth(220);</b>
<b class="nc">&nbsp;        HBox searchBox = new HBox(8, new Label(&quot;\uD83D\uDD0D&quot;), searchField);</b>
<b class="nc">&nbsp;        searchBox.setAlignment(Pos.CENTER_LEFT);</b>
&nbsp;
<b class="nc">&nbsp;        Button addBtn = new Button(&quot;+ Add&quot;);</b>
<b class="nc">&nbsp;        addBtn.setStyle(BUTTON_STYLE_PRIMARY);</b>
<b class="nc">&nbsp;        addBtn.setTooltip(new Tooltip(addTooltip));</b>
<b class="nc">&nbsp;        addBtn.setOnAction(addAction);</b>
&nbsp;
<b class="nc">&nbsp;        Region spacer = new Region();</b>
<b class="nc">&nbsp;        HBox.setHgrow(spacer, Priority.ALWAYS);</b>
<b class="nc">&nbsp;        HBox searchAddRow = new HBox(0, searchBox, spacer, addBtn);</b>
<b class="nc">&nbsp;        searchAddRow.setAlignment(Pos.CENTER_LEFT);</b>
<b class="nc">&nbsp;        searchAddRow.setPadding(new Insets(0, 0, 12, 0));</b>
&nbsp;
&nbsp;        // Return HBox (contains search field and add button)
<b class="nc">&nbsp;        return searchAddRow;</b>
&nbsp;    }
&nbsp;
&nbsp;    // Helper to extract the search field from the SearchAddBar HBox
&nbsp;    private TextField getSearchFieldFromBar(HBox searchAddBar) {
<b class="nc">&nbsp;        if (searchAddBar != null &amp;&amp; searchAddBar.getChildren().get(0) instanceof HBox searchBox &amp;&amp; searchBox.getChildren().size() &gt; 1 &amp;&amp; searchBox.getChildren().get(1) instanceof TextField) {</b>
<b class="nc">&nbsp;            return (TextField) searchBox.getChildren().get(1);</b>
&nbsp;        }
<b class="nc">&nbsp;        return null; // Or throw an exception if it&#39;s critical</b>
&nbsp;    }
&nbsp;
&nbsp;    private &lt;T&gt; VBox createMainScreenLayout(HBox topBar, HBox searchAddBar, TableView&lt;T&gt; table) {
<b class="nc">&nbsp;        VBox tableBox = new VBox(0, searchAddBar, table);</b>
<b class="nc">&nbsp;        tableBox.setPadding(new Insets(0, 0, 0, 0));</b>
<b class="nc">&nbsp;        VBox root = new VBox(18, topBar, tableBox);</b>
<b class="nc">&nbsp;        root.setPadding(new Insets(20));</b>
<b class="nc">&nbsp;        root.setStyle(&quot;-fx-background-color: #fcfcfc;&quot;);</b>
<b class="nc">&nbsp;        VBox.setVgrow(tableBox, Priority.ALWAYS);</b>
<b class="nc">&nbsp;        return root;</b>
&nbsp;    }
&nbsp;
&nbsp;    // --- Patient Management ---
&nbsp;    private void showPatientManagement(Stage stage, String role) {
<b class="nc">&nbsp;        HBox topBar = createTopBar(&quot;Patient Management&quot;, stage, role);</b>
<b class="nc">&nbsp;        HBox searchAddRow = createSearchAddBar(&quot;Search patients...&quot;, &quot;Add a new patient&quot;, e -&gt; showAddPatientDialog());</b>
<b class="nc">&nbsp;        TextField searchField = getSearchFieldFromBar(searchAddRow);</b>
&nbsp;
<b class="nc">&nbsp;        TableView&lt;Patient&gt; table = createPatientTable();</b>
<b class="nc">&nbsp;        VBox root = createMainScreenLayout(topBar, searchAddRow, table);</b>
&nbsp;
&nbsp;        // Logic
<b class="nc">&nbsp;        refreshPatientList();</b>
<b class="nc">&nbsp;        if (searchField != null) {</b>
<b class="nc">&nbsp;            searchField.textProperty().addListener((obs, oldVal, newVal) -&gt; filterPatientList(newVal));</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        stage.setTitle(&quot;Hospital System - Patient Management&quot;);</b>
<b class="nc">&nbsp;        stage.setScene(new Scene(root, 1100, 600));</b>
&nbsp;    }
&nbsp;
&nbsp;    private TableView&lt;Patient&gt; createPatientTable() {
<b class="nc">&nbsp;        TableView&lt;Patient&gt; table = new TableView&lt;&gt;(patientList);</b>
<b class="nc">&nbsp;        table.setPrefHeight(420);</b>
<b class="nc">&nbsp;        TableColumn&lt;Patient, String&gt; idCol = new TableColumn&lt;&gt;(&quot;ID&quot;);</b>
<b class="nc">&nbsp;        idCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;patientId&quot;));</b>
<b class="nc">&nbsp;        idCol.setPrefWidth(80);</b>
<b class="nc">&nbsp;        TableColumn&lt;Patient, String&gt; nameCol = new TableColumn&lt;&gt;(&quot;Name&quot;);</b>
<b class="nc">&nbsp;        nameCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;patientName&quot;));</b>
<b class="nc">&nbsp;        nameCol.setPrefWidth(180);</b>
<b class="nc">&nbsp;        TableColumn&lt;Patient, LocalDate&gt; dobCol = new TableColumn&lt;&gt;(&quot;Date of Birth&quot;);</b>
<b class="nc">&nbsp;        dobCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;dateOfBirth&quot;));</b>
<b class="nc">&nbsp;        dobCol.setPrefWidth(120);</b>
<b class="nc">&nbsp;        TableColumn&lt;Patient, Integer&gt; ageCol = new TableColumn&lt;&gt;(&quot;Age&quot;);</b>
<b class="nc">&nbsp;        ageCol.setCellValueFactory(cellData -&gt; new SimpleIntegerProperty(cellData.getValue().getPatientAge()).asObject());</b>
<b class="nc">&nbsp;        ageCol.setPrefWidth(60);</b>
<b class="nc">&nbsp;        TableColumn&lt;Patient, String&gt; admittedCol = new TableColumn&lt;&gt;(&quot;Admitted&quot;);</b>
<b class="nc">&nbsp;        admittedCol.setCellValueFactory(data -&gt; new SimpleStringProperty(data.getValue().isPatientAdmitted() ? &quot;Yes&quot; : &quot;No&quot;));</b>
<b class="nc">&nbsp;        admittedCol.setPrefWidth(80);</b>
<b class="nc">&nbsp;        TableColumn&lt;Patient, Void&gt; actionsCol = createPatientActionsColumn();</b>
<b class="nc">&nbsp;        actionsCol.setPrefWidth(320);</b>
&nbsp;
<b class="nc">&nbsp;        table.getColumns().setAll(idCol, nameCol, dobCol, ageCol, admittedCol, actionsCol);</b>
<b class="nc">&nbsp;        table.setPlaceholder(new Label(&quot;No patients registered yet&quot;));</b>
<b class="nc">&nbsp;        table.setColumnResizePolicy(TableView.CONSTRAINED_RESIZE_POLICY_ALL_COLUMNS);</b>
<b class="nc">&nbsp;        table.setStyle(&quot;-fx-background-color: #f8f8f8; -fx-border-color: #cccccc; -fx-border-radius: 5; -fx-background-radius: 5;&quot;);</b>
<b class="nc">&nbsp;        VBox.setVgrow(table, Priority.ALWAYS);</b>
<b class="nc">&nbsp;        return table;</b>
&nbsp;    }
&nbsp;
&nbsp;    private TableColumn&lt;Patient, Void&gt; createPatientActionsColumn() {
<b class="nc">&nbsp;        TableColumn&lt;Patient, Void&gt; actionsCol = new TableColumn&lt;&gt;(&quot;Actions&quot;);</b>
<b class="nc">&nbsp;        actionsCol.setCellFactory(col -&gt; new TableCell&lt;&gt;() {</b>
<b class="nc">&nbsp;            private final Button viewBtn = new Button(&quot;View&quot;);</b>
<b class="nc">&nbsp;            private final Button editBtn = new Button(&quot;Edit&quot;);</b>
<b class="nc">&nbsp;            private final Button deleteBtn = new Button(&quot;Delete&quot;);</b>
<b class="nc">&nbsp;            private final Button admitBtn = new Button(&quot;Admit&quot;);</b>
<b class="nc">&nbsp;            private final Button dischargeBtn = new Button(&quot;Discharge&quot;);</b>
&nbsp;            {
<b class="nc">&nbsp;                viewBtn.setOnAction(e -&gt; showPatientDetails(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                editBtn.setOnAction(e -&gt; showEditPatientDialog(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                deleteBtn.setOnAction(e -&gt; deletePatientAction(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                admitBtn.setOnAction(e -&gt; admitPatientAction(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                dischargeBtn.setOnAction(e -&gt; dischargePatientAction(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                viewBtn.setStyle(BUTTON_STYLE_VIEW);</b>
<b class="nc">&nbsp;                editBtn.setStyle(BUTTON_STYLE_EDIT);</b>
<b class="nc">&nbsp;                deleteBtn.setStyle(BUTTON_STYLE_DELETE);</b>
<b class="nc">&nbsp;                admitBtn.setStyle(BUTTON_STYLE_ACTION1);</b>
<b class="nc">&nbsp;                dischargeBtn.setStyle(BUTTON_STYLE_ACTION2);</b>
&nbsp;            }
&nbsp;            @Override
&nbsp;            protected void updateItem(Void item, boolean empty) {
<b class="nc">&nbsp;                super.updateItem(item, empty);</b>
<b class="nc">&nbsp;                if (empty || getIndex() &lt; 0 || getIndex() &gt;= getTableView().getItems().size()) {</b>
<b class="nc">&nbsp;                    setGraphic(null);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    Patient p = getTableView().getItems().get(getIndex());</b>
<b class="nc">&nbsp;                    HBox box = new HBox(6, viewBtn, editBtn, deleteBtn);</b>
<b class="nc">&nbsp;                    if (p.isPatientAdmitted()) {</b>
<b class="nc">&nbsp;                        box.getChildren().add(dischargeBtn);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        box.getChildren().add(admitBtn);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    setGraphic(box);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;        return actionsCol;</b>
&nbsp;    }
&nbsp;
&nbsp;    private void refreshPatientList() {
&nbsp;        try {
<b class="nc">&nbsp;            patientList.setAll(controller.getAllPatients());</b>
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            showError(&quot;Failed to load patients: &quot; + ex.getMessage());</b>
<b class="nc">&nbsp;            patientList.clear();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void filterPatientList(String searchText) {
&nbsp;        try {
<b class="nc">&nbsp;            List&lt;Patient&gt; allPatients = controller.getAllPatients();</b>
<b class="nc">&nbsp;            if (searchText == null || searchText.isEmpty()) {</b>
<b class="nc">&nbsp;                patientList.setAll(allPatients);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                String lowerCaseFilter = searchText.toLowerCase();</b>
<b class="nc">&nbsp;                patientList.setAll(allPatients.stream()</b>
<b class="nc">&nbsp;                        .filter(p -&gt; p.getPatientName().toLowerCase().contains(lowerCaseFilter) ||</b>
<b class="nc">&nbsp;                                     p.getPatientId().toLowerCase().contains(lowerCaseFilter))</b>
<b class="nc">&nbsp;                        .collect(Collectors.toList()));</b>
&nbsp;            }
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            showError(&quot;Failed to filter patients: &quot; + ex.getMessage());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void showPatientDetails(Patient patient) {
<b class="nc">&nbsp;        Alert alert = new Alert(Alert.AlertType.INFORMATION);</b>
<b class="nc">&nbsp;        alert.setTitle(&quot;Patient Details&quot;);</b>
<b class="nc">&nbsp;        alert.setHeaderText(&quot;Patient: &quot; + patient.getPatientName());</b>
<b class="nc">&nbsp;        alert.setContentText(&quot;ID: &quot; + patient.getPatientId() +</b>
<b class="nc">&nbsp;                &quot;\nDate of Birth: &quot; + patient.getDateOfBirth() +</b>
<b class="nc">&nbsp;                &quot;\nAge: &quot; + patient.getPatientAge() +</b>
<b class="nc">&nbsp;                &quot;\nAdmitted: &quot; + (patient.isPatientAdmitted() ? &quot;Yes&quot; : &quot;No&quot;));</b>
<b class="nc">&nbsp;        alert.showAndWait();</b>
&nbsp;    }
&nbsp;
&nbsp;    private void showAddPatientDialog() {
<b class="nc">&nbsp;        Dialog&lt;Patient&gt; dialog = new Dialog&lt;&gt;();</b>
<b class="nc">&nbsp;        dialog.setTitle(&quot;Add Patient&quot;);</b>
<b class="nc">&nbsp;        dialog.setHeaderText(&quot;Enter New Patient Details&quot;);</b>
&nbsp;
&nbsp;        // Controls
<b class="nc">&nbsp;        TextField nameField = new TextField(); nameField.setPromptText(&quot;Name&quot;);</b>
<b class="nc">&nbsp;        DatePicker dobPicker = new DatePicker(); dobPicker.setPromptText(&quot;Date of Birth&quot;);</b>
&nbsp;
&nbsp;        // Layout
<b class="nc">&nbsp;        VBox vbox = new VBox(10, new Label(&quot;Name:&quot;), nameField, new Label(&quot;Date of Birth:&quot;), dobPicker);</b>
<b class="nc">&nbsp;        vbox.setPadding(new Insets(10));</b>
<b class="nc">&nbsp;        dialog.getDialogPane().setContent(vbox);</b>
<b class="nc">&nbsp;        dialog.getDialogPane().getButtonTypes().addAll(ButtonType.OK, ButtonType.CANCEL);</b>
&nbsp;
&nbsp;        // Enable OK only when valid
<b class="nc">&nbsp;        Node okButton = dialog.getDialogPane().lookupButton(ButtonType.OK);</b>
<b class="nc">&nbsp;        okButton.setDisable(true);</b>
<b class="nc">&nbsp;        nameField.textProperty().addListener((obs, oldV, newV) -&gt; okButton.setDisable(newV.trim().isEmpty() || dobPicker.getValue() == null));</b>
<b class="nc">&nbsp;        dobPicker.valueProperty().addListener((obs, oldV, newV) -&gt; okButton.setDisable(newV == null || nameField.getText().trim().isEmpty()));</b>
&nbsp;
&nbsp;        // Result converter
<b class="nc">&nbsp;        dialog.setResultConverter(dialogButton -&gt; {</b>
<b class="nc">&nbsp;            if (dialogButton == ButtonType.OK) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    String name = nameField.getText().trim();</b>
<b class="nc">&nbsp;                    LocalDate dob = dobPicker.getValue();</b>
&nbsp;                    // Basic validation (more in Patient constructor)
<b class="nc">&nbsp;                    if (dob.isAfter(LocalDate.now())) {</b>
<b class="nc">&nbsp;                         showError(&quot;Date of Birth cannot be in the future.&quot;);</b>
<b class="nc">&nbsp;                         return null;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    String id = &quot;P&quot; + (controller.getAllPatients().size() + 101); // Simple ID</b>
<b class="nc">&nbsp;                    return new Patient(id, name, dob);</b>
&nbsp;                } catch (Exception e) {
<b class="nc">&nbsp;                    showError(&quot;Invalid input: &quot; + e.getMessage());</b>
<b class="nc">&nbsp;                    return null;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return null;</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        Optional&lt;Patient&gt; result = dialog.showAndWait();</b>
<b class="nc">&nbsp;        result.ifPresent(patient -&gt; {</b>
&nbsp;            try {
<b class="nc">&nbsp;                controller.registerPatient(patient);</b>
<b class="nc">&nbsp;                refreshPatientList();</b>
&nbsp;            } catch (Exception ex) {
<b class="nc">&nbsp;                showError(&quot;Failed to add patient: &quot; + ex.getMessage());</b>
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    private void showEditPatientDialog(Patient patient) {
<b class="nc">&nbsp;        Dialog&lt;String&gt; dialog = new Dialog&lt;&gt;();</b>
<b class="nc">&nbsp;        dialog.setTitle(&quot;Edit Patient Name&quot;);</b>
<b class="nc">&nbsp;        dialog.setHeaderText(&quot;Editing Name for Patient ID: &quot; + patient.getPatientId());</b>
&nbsp;
<b class="nc">&nbsp;        TextField nameField = new TextField(patient.getPatientName());</b>
<b class="nc">&nbsp;        VBox vbox = new VBox(10, new Label(&quot;New Name:&quot;), nameField);</b>
<b class="nc">&nbsp;        vbox.setPadding(new Insets(10));</b>
<b class="nc">&nbsp;        dialog.getDialogPane().setContent(vbox);</b>
<b class="nc">&nbsp;        dialog.getDialogPane().getButtonTypes().addAll(ButtonType.OK, ButtonType.CANCEL);</b>
&nbsp;
&nbsp;        // Enable OK only if name is not empty
<b class="nc">&nbsp;        Node okButton = dialog.getDialogPane().lookupButton(ButtonType.OK);</b>
<b class="nc">&nbsp;        okButton.setDisable(nameField.getText().trim().isEmpty());</b>
<b class="nc">&nbsp;        nameField.textProperty().addListener((obs, oldV, newV) -&gt; okButton.setDisable(newV.trim().isEmpty()));</b>
&nbsp;
<b class="nc">&nbsp;        dialog.setResultConverter(dialogButton -&gt; dialogButton == ButtonType.OK ? nameField.getText().trim() : null);</b>
&nbsp;
<b class="nc">&nbsp;        Optional&lt;String&gt; result = dialog.showAndWait();</b>
<b class="nc">&nbsp;        result.ifPresent(newName -&gt; {</b>
&nbsp;            try {
<b class="nc">&nbsp;                patient.setPatientName(newName); // Update local object</b>
<b class="nc">&nbsp;                controller.updatePatient(patient); // Persist change via controller/service</b>
<b class="nc">&nbsp;                refreshPatientList(); // Refresh the table view</b>
&nbsp;            } catch (Exception ex) {
<b class="nc">&nbsp;                showError(&quot;Failed to update patient name: &quot; + ex.getMessage());</b>
<b class="nc">&nbsp;                 refreshPatientList(); // Refresh to show original state</b>
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    private void deletePatientAction(Patient patient) {
<b class="nc">&nbsp;        Alert confirm = new Alert(Alert.AlertType.CONFIRMATION,</b>
<b class="nc">&nbsp;                &quot;Are you sure you want to delete patient &#39;&quot; + patient.getPatientName() + &quot;&#39; (ID: &quot; + patient.getPatientId() + &quot;)?&quot;,</b>
&nbsp;                ButtonType.YES, ButtonType.NO);
<b class="nc">&nbsp;        confirm.setTitle(&quot;Confirm Deletion&quot;);</b>
<b class="nc">&nbsp;        confirm.setHeaderText(null);</b>
&nbsp;
<b class="nc">&nbsp;        confirm.showAndWait().ifPresent(response -&gt; {</b>
<b class="nc">&nbsp;            if (response == ButtonType.YES) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    boolean deleted = controller.deletePatient(patient.getPatientId());</b>
<b class="nc">&nbsp;                    if (deleted) {</b>
<b class="nc">&nbsp;                        refreshPatientList();</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        showError(&quot;Patient could not be found or deleted.&quot;);</b>
&nbsp;                    }
&nbsp;                } catch (Exception ex) {
<b class="nc">&nbsp;                    showError(&quot;Failed to delete patient: &quot; + ex.getMessage());</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    private void admitPatientAction(Patient patient) {
&nbsp;        try {
<b class="nc">&nbsp;            patient.admitPatient(); // Update local state</b>
<b class="nc">&nbsp;            controller.updatePatient(patient); // Persist change</b>
<b class="nc">&nbsp;            refreshPatientList(); // Refresh table</b>
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            showError(&quot;Failed to admit patient: &quot; + ex.getMessage());</b>
<b class="nc">&nbsp;            refreshPatientList(); // Refresh to show original state</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void dischargePatientAction(Patient patient) {
&nbsp;         try {
<b class="nc">&nbsp;            patient.dischargePatient(); // Update local state</b>
<b class="nc">&nbsp;            controller.updatePatient(patient); // Persist change</b>
<b class="nc">&nbsp;            refreshPatientList(); // Refresh table</b>
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            showError(&quot;Failed to discharge patient: &quot; + ex.getMessage());</b>
<b class="nc">&nbsp;            refreshPatientList(); // Refresh to show original state</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    // --- Appointment Scheduling ---
&nbsp;    private void showAppointmentScheduling(Stage stage, String role) {
<b class="nc">&nbsp;        HBox topBar = createTopBar(&quot;Appointment Scheduling&quot;, stage, role);</b>
<b class="nc">&nbsp;        HBox searchAddRow = createSearchAddBar(&quot;Search by patient name or ID...&quot;, &quot;Schedule a new appointment&quot;, e -&gt; showAddAppointmentDialog());</b>
<b class="nc">&nbsp;        TextField searchField = getSearchFieldFromBar(searchAddRow);</b>
&nbsp;
<b class="nc">&nbsp;        TableView&lt;Appointment&gt; table = createAppointmentTable();</b>
<b class="nc">&nbsp;        VBox root = createMainScreenLayout(topBar, searchAddRow, table);</b>
&nbsp;
&nbsp;        // Logic
<b class="nc">&nbsp;        refreshAppointmentList();</b>
<b class="nc">&nbsp;        if (searchField != null) {</b>
<b class="nc">&nbsp;            searchField.textProperty().addListener((obs, oldVal, newVal) -&gt; filterAppointmentList(newVal));</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        stage.setTitle(&quot;Hospital System - Appointment Scheduling&quot;);</b>
<b class="nc">&nbsp;        stage.setScene(new Scene(root, 1100, 600));</b>
&nbsp;    }
&nbsp;
&nbsp;    private TableView&lt;Appointment&gt; createAppointmentTable() {
<b class="nc">&nbsp;        TableView&lt;Appointment&gt; table = new TableView&lt;&gt;(appointmentList);</b>
<b class="nc">&nbsp;        table.setPrefHeight(420);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;Appointment, String&gt; idCol = new TableColumn&lt;&gt;(&quot;Appt ID&quot;);</b>
<b class="nc">&nbsp;        idCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;appointmentId&quot;));</b>
<b class="nc">&nbsp;        idCol.setPrefWidth(80);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;Appointment, String&gt; patientNameCol = new TableColumn&lt;&gt;(&quot;Patient Name&quot;);</b>
<b class="nc">&nbsp;        patientNameCol.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getPatient().getPatientName()));</b>
<b class="nc">&nbsp;        patientNameCol.setPrefWidth(150);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;Appointment, String&gt; patientIdCol = new TableColumn&lt;&gt;(&quot;Patient ID&quot;);</b>
<b class="nc">&nbsp;        patientIdCol.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getPatient().getPatientId()));</b>
<b class="nc">&nbsp;        patientIdCol.setPrefWidth(80);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;Appointment, LocalDateTime&gt; dateTimeCol = new TableColumn&lt;&gt;(&quot;Date &amp; Time&quot;);</b>
<b class="nc">&nbsp;        dateTimeCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;dateTime&quot;));</b>
<b class="nc">&nbsp;        dateTimeCol.setPrefWidth(150);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;Appointment, String&gt; typeCol = new TableColumn&lt;&gt;(&quot;Type&quot;);</b>
<b class="nc">&nbsp;        typeCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;type&quot;));</b>
<b class="nc">&nbsp;        typeCol.setPrefWidth(120);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;Appointment, String&gt; statusCol = new TableColumn&lt;&gt;(&quot;Status&quot;);</b>
<b class="nc">&nbsp;        statusCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;status&quot;));</b>
<b class="nc">&nbsp;        statusCol.setPrefWidth(100);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;Appointment, Void&gt; actionsCol = createAppointmentActionsColumn();</b>
<b class="nc">&nbsp;        actionsCol.setPrefWidth(300);</b>
&nbsp;
<b class="nc">&nbsp;        table.getColumns().setAll(idCol, patientNameCol, patientIdCol, dateTimeCol, typeCol, statusCol, actionsCol);</b>
<b class="nc">&nbsp;        table.setPlaceholder(new Label(&quot;No appointments scheduled yet&quot;));</b>
<b class="nc">&nbsp;        table.setColumnResizePolicy(TableView.CONSTRAINED_RESIZE_POLICY_ALL_COLUMNS);</b>
<b class="nc">&nbsp;        table.setStyle(&quot;-fx-background-color: #f8f8f8; -fx-border-color: #cccccc; -fx-border-radius: 5; -fx-background-radius: 5;&quot;);</b>
<b class="nc">&nbsp;        VBox.setVgrow(table, Priority.ALWAYS);</b>
<b class="nc">&nbsp;        return table;</b>
&nbsp;    }
&nbsp;
&nbsp;    private TableColumn&lt;Appointment, Void&gt; createAppointmentActionsColumn() {
<b class="nc">&nbsp;        TableColumn&lt;Appointment, Void&gt; actionsCol = new TableColumn&lt;&gt;(&quot;Actions&quot;);</b>
<b class="nc">&nbsp;        actionsCol.setCellFactory(col -&gt; new TableCell&lt;&gt;() {</b>
<b class="nc">&nbsp;            private final Button editBtn = new Button(&quot;Edit&quot;);</b>
<b class="nc">&nbsp;            private final Button completeBtn = new Button(&quot;Complete&quot;);</b>
<b class="nc">&nbsp;            private final Button cancelBtn = new Button(&quot;Cancel&quot;);</b>
<b class="nc">&nbsp;            private final Button deleteBtn = new Button(&quot;Delete&quot;);</b>
&nbsp;            {
<b class="nc">&nbsp;                editBtn.setOnAction(e -&gt; showEditAppointmentDialog(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                completeBtn.setOnAction(e -&gt; completeAppointmentAction(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                cancelBtn.setOnAction(e -&gt; cancelAppointmentAction(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                deleteBtn.setOnAction(e -&gt; deleteAppointmentAction(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                editBtn.setStyle(BUTTON_STYLE_EDIT);</b>
<b class="nc">&nbsp;                completeBtn.setStyle(BUTTON_STYLE_ACTION1);</b>
<b class="nc">&nbsp;                cancelBtn.setStyle(BUTTON_STYLE_ACTION2);</b>
<b class="nc">&nbsp;                deleteBtn.setStyle(BUTTON_STYLE_DELETE);</b>
&nbsp;            }
&nbsp;
&nbsp;            @Override
&nbsp;            protected void updateItem(Void item, boolean empty) {
<b class="nc">&nbsp;                super.updateItem(item, empty);</b>
<b class="nc">&nbsp;                if (empty || getIndex() &lt; 0 || getIndex() &gt;= getTableView().getItems().size()) {</b>
<b class="nc">&nbsp;                    setGraphic(null);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    Appointment appt = getTableView().getItems().get(getIndex());</b>
<b class="nc">&nbsp;                    HBox box = new HBox(6);</b>
<b class="nc">&nbsp;                    if (appt.getStatus() == Appointment.Status.SCHEDULED) {</b>
<b class="nc">&nbsp;                        box.getChildren().addAll(editBtn, completeBtn, cancelBtn);</b>
&nbsp;                    } else {
&nbsp;                         // Optionally add edit button even for completed/cancelled if desired
&nbsp;                         // box.getChildren().add(editBtn);
&nbsp;                    }
<b class="nc">&nbsp;                    box.getChildren().add(deleteBtn);</b>
<b class="nc">&nbsp;                    setGraphic(box);</b>
&nbsp;
&nbsp;                    // Disable buttons based on status
<b class="nc">&nbsp;                    editBtn.setDisable(appt.getStatus() != Appointment.Status.SCHEDULED);</b>
<b class="nc">&nbsp;                    completeBtn.setDisable(appt.getStatus() != Appointment.Status.SCHEDULED);</b>
<b class="nc">&nbsp;                    cancelBtn.setDisable(appt.getStatus() != Appointment.Status.SCHEDULED);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;        actionsCol.setPrefWidth(320); // Adjust width slightly</b>
<b class="nc">&nbsp;        return actionsCol;</b>
&nbsp;    }
&nbsp;
&nbsp;    private void refreshAppointmentList() {
&nbsp;        try {
<b class="nc">&nbsp;            appointmentList.setAll(controller.getAllAppointments());</b>
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            showError(&quot;Failed to load appointments: &quot; + ex.getMessage());</b>
<b class="nc">&nbsp;            appointmentList.clear();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void filterAppointmentList(String searchText) {
&nbsp;        try {
<b class="nc">&nbsp;            List&lt;Appointment&gt; allAppointments = controller.getAllAppointments();</b>
<b class="nc">&nbsp;            if (searchText == null || searchText.isEmpty()) {</b>
<b class="nc">&nbsp;                appointmentList.setAll(allAppointments);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                String lowerCaseFilter = searchText.toLowerCase();</b>
<b class="nc">&nbsp;                appointmentList.setAll(allAppointments.stream()</b>
<b class="nc">&nbsp;                        .filter(a -&gt; a.getPatient().getPatientName().toLowerCase().contains(lowerCaseFilter) ||</b>
<b class="nc">&nbsp;                                     a.getPatient().getPatientId().toLowerCase().contains(lowerCaseFilter) ||</b>
<b class="nc">&nbsp;                                     a.getAppointmentId().toLowerCase().contains(lowerCaseFilter) ||</b>
<b class="nc">&nbsp;                                     a.getType().toLowerCase().contains(lowerCaseFilter))</b>
<b class="nc">&nbsp;                        .collect(Collectors.toList()));</b>
&nbsp;            }
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            showError(&quot;Failed to filter appointments: &quot; + ex.getMessage());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void showAddAppointmentDialog() {
<b class="nc">&nbsp;        Dialog&lt;Appointment&gt; dialog = new Dialog&lt;&gt;();</b>
<b class="nc">&nbsp;        dialog.setTitle(&quot;Schedule Appointment&quot;);</b>
<b class="nc">&nbsp;        dialog.setHeaderText(&quot;Enter Appointment Details&quot;);</b>
&nbsp;
&nbsp;        // Controls
<b class="nc">&nbsp;        ComboBox&lt;Patient&gt; patientCombo = new ComboBox&lt;&gt;(patientList); // Use existing patient list</b>
<b class="nc">&nbsp;        patientCombo.setPromptText(&quot;Select Patient&quot;);</b>
<b class="nc">&nbsp;        DatePicker datePicker = new DatePicker(LocalDate.now());</b>
&nbsp;        // Basic Time Picker (Consider a better control for real apps)
<b class="nc">&nbsp;        ComboBox&lt;Integer&gt; hourCombo = new ComboBox&lt;&gt;(FXCollections.observableArrayList(8, 9, 10, 11, 12, 13, 14, 15, 16, 17)); hourCombo.setPromptText(&quot;Hour&quot;);</b>
<b class="nc">&nbsp;        ComboBox&lt;Integer&gt; minuteCombo = new ComboBox&lt;&gt;(FXCollections.observableArrayList(0, 15, 30, 45)); minuteCombo.setPromptText(&quot;Minute&quot;);</b>
<b class="nc">&nbsp;        TextField typeField = new TextField(); typeField.setPromptText(&quot;Appointment Type (e.g., Checkup)&quot;);</b>
&nbsp;
&nbsp;        // Layout
<b class="nc">&nbsp;        HBox timeBox = new HBox(5, hourCombo, new Label(&quot;:&quot;), minuteCombo);</b>
<b class="nc">&nbsp;        VBox vbox = new VBox(10, new Label(&quot;Patient:&quot;), patientCombo,</b>
&nbsp;                             new Label(&quot;Date:&quot;), datePicker,
&nbsp;                             new Label(&quot;Time:&quot;), timeBox,
&nbsp;                             new Label(&quot;Type:&quot;), typeField);
<b class="nc">&nbsp;        vbox.setPadding(new Insets(10));</b>
<b class="nc">&nbsp;        dialog.getDialogPane().setContent(vbox);</b>
<b class="nc">&nbsp;        dialog.getDialogPane().getButtonTypes().addAll(ButtonType.OK, ButtonType.CANCEL);</b>
&nbsp;
&nbsp;        // Enable OK only when all fields are valid
<b class="nc">&nbsp;        Node okButton = dialog.getDialogPane().lookupButton(ButtonType.OK);</b>
<b class="nc">&nbsp;        okButton.setDisable(true);</b>
<b class="nc">&nbsp;        Runnable updateOkButtonState = () -&gt; {</b>
<b class="nc">&nbsp;            boolean disabled = patientCombo.getValue() == null ||</b>
<b class="nc">&nbsp;                               datePicker.getValue() == null ||</b>
<b class="nc">&nbsp;                               hourCombo.getValue() == null ||</b>
<b class="nc">&nbsp;                               minuteCombo.getValue() == null ||</b>
<b class="nc">&nbsp;                               typeField.getText().trim().isEmpty();</b>
<b class="nc">&nbsp;            okButton.setDisable(disabled);</b>
&nbsp;        };
<b class="nc">&nbsp;        patientCombo.valueProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
<b class="nc">&nbsp;        datePicker.valueProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
<b class="nc">&nbsp;        hourCombo.valueProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
<b class="nc">&nbsp;        minuteCombo.valueProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
<b class="nc">&nbsp;        typeField.textProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
&nbsp;
&nbsp;
&nbsp;        // Result Converter
<b class="nc">&nbsp;        dialog.setResultConverter(dialogButton -&gt; {</b>
<b class="nc">&nbsp;            if (dialogButton == ButtonType.OK) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    Patient selectedPatient = patientCombo.getValue();</b>
<b class="nc">&nbsp;                    LocalDate date = datePicker.getValue();</b>
<b class="nc">&nbsp;                    int hour = hourCombo.getValue();</b>
<b class="nc">&nbsp;                    int minute = minuteCombo.getValue();</b>
<b class="nc">&nbsp;                    LocalDateTime dateTime = LocalDateTime.of(date, LocalTime.of(hour, minute));</b>
<b class="nc">&nbsp;                    String type = typeField.getText().trim();</b>
&nbsp;
<b class="nc">&nbsp;                    if (dateTime.isBefore(LocalDateTime.now())) {</b>
<b class="nc">&nbsp;                        showError(&quot;Appointment date/time cannot be in the past.&quot;);</b>
<b class="nc">&nbsp;                        return null;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    String id = &quot;A&quot; + (controller.getAllAppointments().size() + 1001); // Simple ID</b>
<b class="nc">&nbsp;                    return new Appointment(id, selectedPatient, dateTime, type);</b>
&nbsp;                } catch (Exception e) {
<b class="nc">&nbsp;                    showError(&quot;Invalid input: &quot; + e.getMessage());</b>
<b class="nc">&nbsp;                    return null;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return null;</b>
&nbsp;        });
&nbsp;
&nbsp;        // Refresh patient list for the combo box before showing
<b class="nc">&nbsp;        refreshPatientList();</b>
<b class="nc">&nbsp;        if (patientList.isEmpty()) {</b>
<b class="nc">&nbsp;             showError(&quot;Cannot schedule appointment: No patients registered.&quot;);</b>
&nbsp;             return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Optional&lt;Appointment&gt; result = dialog.showAndWait();</b>
<b class="nc">&nbsp;        result.ifPresent(appointment -&gt; {</b>
&nbsp;            try {
<b class="nc">&nbsp;                controller.scheduleAppointment(appointment);</b>
<b class="nc">&nbsp;                refreshAppointmentList();</b>
&nbsp;            } catch (Exception ex) {
<b class="nc">&nbsp;                showError(&quot;Failed to schedule appointment: &quot; + ex.getMessage());</b>
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    private void completeAppointmentAction(Appointment appointment) {
&nbsp;        try {
<b class="nc">&nbsp;            appointment.complete(); // Update local state</b>
<b class="nc">&nbsp;            controller.updateAppointment(appointment); // Persist change</b>
<b class="nc">&nbsp;            refreshAppointmentList(); // Refresh table</b>
&nbsp;        } catch (IllegalStateException ise) {
<b class="nc">&nbsp;             showError(&quot;Cannot complete appointment: &quot; + ise.getMessage());</b>
<b class="nc">&nbsp;             refreshAppointmentList(); // Refresh just in case state was inconsistent</b>
&nbsp;        }
&nbsp;         catch (Exception ex) {
<b class="nc">&nbsp;            showError(&quot;Failed to complete appointment: &quot; + ex.getMessage());</b>
<b class="nc">&nbsp;            refreshAppointmentList(); // Refresh to show original state</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void cancelAppointmentAction(Appointment appointment) {
&nbsp;         try {
<b class="nc">&nbsp;            boolean cancelled = controller.cancelAppointment(appointment.getAppointmentId()); // Use controller/service</b>
<b class="nc">&nbsp;            if (cancelled) {</b>
<b class="nc">&nbsp;                refreshAppointmentList(); // Refresh table</b>
&nbsp;            } else {
<b class="nc">&nbsp;                 showError(&quot;Could not cancel appointment (already cancelled or completed?).&quot;);</b>
<b class="nc">&nbsp;                 refreshAppointmentList(); // Ensure view is up-to-date</b>
&nbsp;            }
&nbsp;        } catch (IllegalStateException ise) {
<b class="nc">&nbsp;             showError(&quot;Cannot cancel appointment: &quot; + ise.getMessage());</b>
<b class="nc">&nbsp;             refreshAppointmentList();</b>
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            showError(&quot;Failed to cancel appointment: &quot; + ex.getMessage());</b>
<b class="nc">&nbsp;            refreshAppointmentList();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void deleteAppointmentAction(Appointment appointment) {
<b class="nc">&nbsp;         Alert confirm = new Alert(Alert.AlertType.CONFIRMATION,</b>
<b class="nc">&nbsp;                &quot;Are you sure you want to delete appointment &#39;&quot; + appointment.getAppointmentId() + &quot;&#39; for patient &#39;&quot; + appointment.getPatient().getPatientName() + &quot;&#39;?&quot;,</b>
&nbsp;                ButtonType.YES, ButtonType.NO);
<b class="nc">&nbsp;        confirm.setTitle(&quot;Confirm Deletion&quot;);</b>
<b class="nc">&nbsp;        confirm.setHeaderText(null);</b>
&nbsp;
<b class="nc">&nbsp;        confirm.showAndWait().ifPresent(response -&gt; {</b>
<b class="nc">&nbsp;            if (response == ButtonType.YES) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    boolean deleted = controller.deleteAppointment(appointment.getAppointmentId());</b>
<b class="nc">&nbsp;                    if (deleted) {</b>
<b class="nc">&nbsp;                        refreshAppointmentList();</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        showError(&quot;Appointment could not be found or deleted.&quot;);</b>
&nbsp;                    }
&nbsp;                } catch (Exception ex) {
<b class="nc">&nbsp;                    showError(&quot;Failed to delete appointment: &quot; + ex.getMessage());</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    private void showEditAppointmentDialog(Appointment appointment) {
<b class="nc">&nbsp;        if (appointment.getStatus() != Appointment.Status.SCHEDULED) {</b>
<b class="nc">&nbsp;            showError(&quot;Only scheduled appointments can be edited.&quot;);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Dialog&lt;Appointment&gt; dialog = new Dialog&lt;&gt;();</b>
<b class="nc">&nbsp;        dialog.setTitle(&quot;Edit Appointment&quot;);</b>
<b class="nc">&nbsp;        dialog.setHeaderText(&quot;Editing Appointment ID: &quot; + appointment.getAppointmentId());</b>
&nbsp;
&nbsp;        // Controls - pre-fill with existing data
<b class="nc">&nbsp;        Label patientLabel = new Label(&quot;Patient: &quot; + appointment.getPatient().getPatientName() + &quot; (ID: &quot; + appointment.getPatient().getPatientId() + &quot;)&quot;);</b>
<b class="nc">&nbsp;        DatePicker datePicker = new DatePicker(appointment.getDateTime().toLocalDate());</b>
<b class="nc">&nbsp;        ComboBox&lt;Integer&gt; hourCombo = new ComboBox&lt;&gt;(FXCollections.observableArrayList(8, 9, 10, 11, 12, 13, 14, 15, 16, 17));</b>
<b class="nc">&nbsp;        hourCombo.setValue(appointment.getDateTime().getHour());</b>
<b class="nc">&nbsp;        ComboBox&lt;Integer&gt; minuteCombo = new ComboBox&lt;&gt;(FXCollections.observableArrayList(0, 15, 30, 45));</b>
<b class="nc">&nbsp;        minuteCombo.setValue(appointment.getDateTime().getMinute());</b>
<b class="nc">&nbsp;        TextField typeField = new TextField(appointment.getType());</b>
&nbsp;
&nbsp;        // Layout
<b class="nc">&nbsp;        HBox timeBox = new HBox(5, hourCombo, new Label(&quot;:&quot;), minuteCombo);</b>
<b class="nc">&nbsp;        VBox vbox = new VBox(10, patientLabel,</b>
&nbsp;                             new Label(&quot;Date:&quot;), datePicker,
&nbsp;                             new Label(&quot;Time:&quot;), timeBox,
&nbsp;                             new Label(&quot;Type:&quot;), typeField);
<b class="nc">&nbsp;        vbox.setPadding(new Insets(10));</b>
<b class="nc">&nbsp;        dialog.getDialogPane().setContent(vbox);</b>
<b class="nc">&nbsp;        dialog.getDialogPane().getButtonTypes().addAll(ButtonType.OK, ButtonType.CANCEL);</b>
&nbsp;
&nbsp;        // Enable OK only when all fields are valid
<b class="nc">&nbsp;        Node okButton = dialog.getDialogPane().lookupButton(ButtonType.OK);</b>
<b class="nc">&nbsp;        okButton.setDisable(false); // Start enabled as fields are pre-filled</b>
<b class="nc">&nbsp;        Runnable updateOkButtonState = () -&gt; {</b>
<b class="nc">&nbsp;            boolean disabled = datePicker.getValue() == null ||</b>
<b class="nc">&nbsp;                               hourCombo.getValue() == null ||</b>
<b class="nc">&nbsp;                               minuteCombo.getValue() == null ||</b>
<b class="nc">&nbsp;                               typeField.getText().trim().isEmpty();</b>
<b class="nc">&nbsp;            okButton.setDisable(disabled);</b>
&nbsp;        };
<b class="nc">&nbsp;        datePicker.valueProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
<b class="nc">&nbsp;        hourCombo.valueProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
<b class="nc">&nbsp;        minuteCombo.valueProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
<b class="nc">&nbsp;        typeField.textProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
&nbsp;
&nbsp;        // Result Converter
<b class="nc">&nbsp;        dialog.setResultConverter(dialogButton -&gt; {</b>
<b class="nc">&nbsp;            if (dialogButton == ButtonType.OK) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    LocalDate date = datePicker.getValue();</b>
<b class="nc">&nbsp;                    int hour = hourCombo.getValue();</b>
<b class="nc">&nbsp;                    int minute = minuteCombo.getValue();</b>
<b class="nc">&nbsp;                    LocalDateTime newDateTime = LocalDateTime.of(date, LocalTime.of(hour, minute));</b>
<b class="nc">&nbsp;                    String newType = typeField.getText().trim();</b>
&nbsp;
<b class="nc">&nbsp;                    if (newDateTime.isBefore(LocalDateTime.now())) {</b>
<b class="nc">&nbsp;                        showError(&quot;New appointment date/time cannot be in the past.&quot;);</b>
<b class="nc">&nbsp;                        return null;</b>
&nbsp;                    }
&nbsp;
&nbsp;                    // Create a new appointment object with updated fields but same ID and patient
&nbsp;                    // Because the original appointment fields are final
<b class="nc">&nbsp;                    return new Appointment(appointment.getAppointmentId(), appointment.getPatient(), newDateTime, newType);</b>
&nbsp;                } catch (IllegalArgumentException e) {
<b class="nc">&nbsp;                    showError(&quot;Invalid input: &quot; + e.getMessage());</b>
<b class="nc">&nbsp;                    return null;</b>
&nbsp;                } catch (Exception e) {
<b class="nc">&nbsp;                    showError(&quot;Error processing input: &quot; + e.getMessage());</b>
<b class="nc">&nbsp;                    return null;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return null;</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        Optional&lt;Appointment&gt; result = dialog.showAndWait();</b>
<b class="nc">&nbsp;        result.ifPresent(updatedAppointment -&gt; {</b>
&nbsp;            try {
<b class="nc">&nbsp;                controller.updateAppointment(updatedAppointment);</b>
<b class="nc">&nbsp;                refreshAppointmentList();</b>
&nbsp;            } catch (Exception ex) {
<b class="nc">&nbsp;                showError(&quot;Failed to update appointment: &quot; + ex.getMessage());</b>
<b class="nc">&nbsp;                refreshAppointmentList(); // Refresh to show original state</b>
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    // --- Medical Records ---
&nbsp;    private void showMedicalRecords(Stage stage, String role) {
<b class="nc">&nbsp;         HBox topBar = createTopBar(&quot;Medical Records&quot;, stage, role);</b>
<b class="nc">&nbsp;         HBox searchAddRow = createSearchAddBar(&quot;Search records by patient or diagnosis...&quot;, &quot;Add a new medical record&quot;, e -&gt; showAddMedicalRecordDialog());</b>
<b class="nc">&nbsp;         TextField searchField = getSearchFieldFromBar(searchAddRow);</b>
&nbsp;
<b class="nc">&nbsp;         TableView&lt;MedicalRecord&gt; table = createMedicalRecordTable();</b>
<b class="nc">&nbsp;         VBox root = createMainScreenLayout(topBar, searchAddRow, table);</b>
&nbsp;
&nbsp;         // Logic
<b class="nc">&nbsp;         refreshMedicalRecordList();</b>
<b class="nc">&nbsp;         if (searchField != null) {</b>
<b class="nc">&nbsp;             searchField.textProperty().addListener((obs, oldVal, newVal) -&gt; filterMedicalRecordList(newVal));</b>
&nbsp;         }
&nbsp;
<b class="nc">&nbsp;         stage.setTitle(&quot;Hospital System - Medical Records&quot;);</b>
<b class="nc">&nbsp;         stage.setScene(new Scene(root, 1100, 600));</b>
&nbsp;    }
&nbsp;
&nbsp;     private TableView&lt;MedicalRecord&gt; createMedicalRecordTable() {
<b class="nc">&nbsp;        TableView&lt;MedicalRecord&gt; table = new TableView&lt;&gt;(recordList);</b>
<b class="nc">&nbsp;        table.setPrefHeight(420);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;MedicalRecord, String&gt; idCol = new TableColumn&lt;&gt;(&quot;Record ID&quot;);</b>
<b class="nc">&nbsp;        idCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;recordId&quot;));</b>
<b class="nc">&nbsp;        idCol.setPrefWidth(100);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;MedicalRecord, String&gt; patientNameCol = new TableColumn&lt;&gt;(&quot;Patient Name&quot;);</b>
<b class="nc">&nbsp;        patientNameCol.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getPatient().getPatientName()));</b>
<b class="nc">&nbsp;        patientNameCol.setPrefWidth(150);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;MedicalRecord, String&gt; patientIdCol = new TableColumn&lt;&gt;(&quot;Patient ID&quot;);</b>
<b class="nc">&nbsp;        patientIdCol.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getPatient().getPatientId()));</b>
<b class="nc">&nbsp;        patientIdCol.setPrefWidth(100);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;MedicalRecord, String&gt; apptIdCol = new TableColumn&lt;&gt;(&quot;Appt ID&quot;);</b>
<b class="nc">&nbsp;        apptIdCol.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getAppointment().getAppointmentId()));</b>
<b class="nc">&nbsp;        apptIdCol.setPrefWidth(100);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;MedicalRecord, LocalDate&gt; dateCol = new TableColumn&lt;&gt;(&quot;Date&quot;);</b>
<b class="nc">&nbsp;        dateCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;date&quot;));</b>
<b class="nc">&nbsp;        dateCol.setPrefWidth(120);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;MedicalRecord, String&gt; diagnosisCol = new TableColumn&lt;&gt;(&quot;Diagnosis&quot;);</b>
<b class="nc">&nbsp;        diagnosisCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;diagnosis&quot;));</b>
<b class="nc">&nbsp;        diagnosisCol.setPrefWidth(200);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;MedicalRecord, Void&gt; actionsCol = createMedicalRecordActionsColumn();</b>
<b class="nc">&nbsp;        actionsCol.setPrefWidth(230);</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;        table.getColumns().setAll(idCol, patientNameCol, patientIdCol, apptIdCol, dateCol, diagnosisCol, actionsCol);</b>
<b class="nc">&nbsp;        table.setPlaceholder(new Label(&quot;No medical records found&quot;));</b>
<b class="nc">&nbsp;        table.setColumnResizePolicy(TableView.CONSTRAINED_RESIZE_POLICY_ALL_COLUMNS);</b>
<b class="nc">&nbsp;        table.setStyle(&quot;-fx-background-color: #f8f8f8; -fx-border-color: #cccccc; -fx-border-radius: 5; -fx-background-radius: 5;&quot;);</b>
<b class="nc">&nbsp;        VBox.setVgrow(table, Priority.ALWAYS);</b>
<b class="nc">&nbsp;        return table;</b>
&nbsp;    }
&nbsp;
&nbsp;      private TableColumn&lt;MedicalRecord, Void&gt; createMedicalRecordActionsColumn() {
<b class="nc">&nbsp;        TableColumn&lt;MedicalRecord, Void&gt; actionsCol = new TableColumn&lt;&gt;(&quot;Actions&quot;);</b>
<b class="nc">&nbsp;        actionsCol.setCellFactory(col -&gt; new TableCell&lt;&gt;() {</b>
<b class="nc">&nbsp;            private final Button viewBtn = new Button(&quot;View Details&quot;);</b>
<b class="nc">&nbsp;            private final Button editBtn = new Button(&quot;Edit&quot;);</b>
<b class="nc">&nbsp;            private final Button deleteBtn = new Button(&quot;Delete&quot;);</b>
&nbsp;            {
<b class="nc">&nbsp;                viewBtn.setOnAction(e -&gt; showMedicalRecordDetails(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                editBtn.setOnAction(e -&gt; showEditMedicalRecordDialog(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                deleteBtn.setOnAction(e -&gt; deleteMedicalRecordAction(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                viewBtn.setStyle(BUTTON_STYLE_VIEW);</b>
<b class="nc">&nbsp;                editBtn.setStyle(BUTTON_STYLE_EDIT);</b>
<b class="nc">&nbsp;                deleteBtn.setStyle(BUTTON_STYLE_DELETE);</b>
&nbsp;            }
&nbsp;            @Override
&nbsp;            protected void updateItem(Void item, boolean empty) {
<b class="nc">&nbsp;                super.updateItem(item, empty);</b>
<b class="nc">&nbsp;                if (empty || getIndex() &lt; 0 || getIndex() &gt;= getTableView().getItems().size()) {</b>
<b class="nc">&nbsp;                    setGraphic(null);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    HBox box = new HBox(6, viewBtn, editBtn, deleteBtn);</b>
<b class="nc">&nbsp;                    setGraphic(box);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;         actionsCol.setPrefWidth(230);</b>
<b class="nc">&nbsp;        return actionsCol;</b>
&nbsp;    }
&nbsp;
&nbsp;    private void refreshMedicalRecordList() {
&nbsp;        try {
<b class="nc">&nbsp;            recordList.setAll(controller.getAllMedicalRecords());</b>
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            showError(&quot;Failed to load medical records: &quot; + ex.getMessage());</b>
<b class="nc">&nbsp;            recordList.clear();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void filterMedicalRecordList(String searchText) {
&nbsp;        try {
<b class="nc">&nbsp;            List&lt;MedicalRecord&gt; allRecords = controller.getAllMedicalRecords();</b>
<b class="nc">&nbsp;            if (searchText == null || searchText.isEmpty()) {</b>
<b class="nc">&nbsp;                recordList.setAll(allRecords);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                String lowerCaseFilter = searchText.toLowerCase();</b>
<b class="nc">&nbsp;                recordList.setAll(allRecords.stream()</b>
<b class="nc">&nbsp;                        .filter(r -&gt; r.getPatient().getPatientName().toLowerCase().contains(lowerCaseFilter) ||</b>
<b class="nc">&nbsp;                                     r.getPatient().getPatientId().toLowerCase().contains(lowerCaseFilter) ||</b>
<b class="nc">&nbsp;                                     r.getRecordId().toLowerCase().contains(lowerCaseFilter) ||</b>
<b class="nc">&nbsp;                                     r.getDiagnosis().toLowerCase().contains(lowerCaseFilter))</b>
<b class="nc">&nbsp;                        .collect(Collectors.toList()));</b>
&nbsp;            }
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            showError(&quot;Failed to filter medical records: &quot; + ex.getMessage());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;     private void showMedicalRecordDetails(MedicalRecord record) {
<b class="nc">&nbsp;        Alert alert = new Alert(Alert.AlertType.INFORMATION);</b>
<b class="nc">&nbsp;        alert.setTitle(&quot;Medical Record Details&quot;);</b>
<b class="nc">&nbsp;        alert.setHeaderText(&quot;Record ID: &quot; + record.getRecordId() + &quot; for Patient: &quot; + record.getPatient().getPatientName());</b>
&nbsp;
<b class="nc">&nbsp;        TextArea textArea = new TextArea();</b>
<b class="nc">&nbsp;        textArea.setEditable(false);</b>
<b class="nc">&nbsp;        textArea.setWrapText(true);</b>
<b class="nc">&nbsp;        textArea.setText(</b>
<b class="nc">&nbsp;                &quot;Patient ID: &quot; + record.getPatient().getPatientId() +</b>
<b class="nc">&nbsp;                &quot;\nAppointment ID: &quot; + record.getAppointment().getAppointmentId() +</b>
<b class="nc">&nbsp;                &quot;\nRecord Date: &quot; + record.getDate() +</b>
<b class="nc">&nbsp;                &quot;\n\nDiagnosis:\n&quot; + record.getDiagnosis() +</b>
<b class="nc">&nbsp;                &quot;\n\nNotes:\n&quot; + (record.getNotes() != null &amp;&amp; !record.getNotes().isEmpty() ? record.getNotes() : &quot;N/A&quot;)</b>
&nbsp;        );
<b class="nc">&nbsp;        textArea.setPrefRowCount(10);</b>
<b class="nc">&nbsp;        textArea.setPrefColumnCount(40);</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;        alert.getDialogPane().setContent(textArea);</b>
<b class="nc">&nbsp;        alert.setResizable(true);</b>
<b class="nc">&nbsp;        alert.showAndWait();</b>
&nbsp;    }
&nbsp;
&nbsp;     private void showEditMedicalRecordDialog(MedicalRecord record) {
<b class="nc">&nbsp;        Dialog&lt;MedicalRecord&gt; dialog = new Dialog&lt;&gt;();</b>
<b class="nc">&nbsp;        dialog.setTitle(&quot;Edit Medical Record&quot;);</b>
<b class="nc">&nbsp;        dialog.setHeaderText(&quot;Editing Record ID: &quot; + record.getRecordId());</b>
&nbsp;
&nbsp;        // Controls - Pre-fill with existing data
<b class="nc">&nbsp;        TextField diagnosisField = new TextField(record.getDiagnosis());</b>
<b class="nc">&nbsp;        TextArea notesArea = new TextArea(record.getNotes());</b>
<b class="nc">&nbsp;        notesArea.setPrefRowCount(4);</b>
&nbsp;
&nbsp;        // Layout
<b class="nc">&nbsp;        VBox vbox = new VBox(10, new Label(&quot;Diagnosis:&quot;), diagnosisField,</b>
&nbsp;                             new Label(&quot;Notes:&quot;), notesArea);
<b class="nc">&nbsp;        vbox.setPadding(new Insets(10));</b>
<b class="nc">&nbsp;        dialog.getDialogPane().setContent(vbox);</b>
<b class="nc">&nbsp;        dialog.getDialogPane().getButtonTypes().addAll(ButtonType.OK, ButtonType.CANCEL);</b>
&nbsp;
&nbsp;        // Enable OK only when diagnosis is not empty
<b class="nc">&nbsp;        Node okButton = dialog.getDialogPane().lookupButton(ButtonType.OK);</b>
<b class="nc">&nbsp;        okButton.setDisable(diagnosisField.getText().trim().isEmpty());</b>
<b class="nc">&nbsp;        diagnosisField.textProperty().addListener((obs, oldV, newV) -&gt; okButton.setDisable(newV.trim().isEmpty()));</b>
&nbsp;
&nbsp;        // Result Converter
<b class="nc">&nbsp;        dialog.setResultConverter(dialogButton -&gt; {</b>
<b class="nc">&nbsp;            if (dialogButton == ButtonType.OK) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    String newDiagnosis = diagnosisField.getText().trim();</b>
<b class="nc">&nbsp;                    String newNotes = notesArea.getText();</b>
&nbsp;
&nbsp;                    // Create a new record object with updated fields but same ID, patient, appt, date
&nbsp;                    // Because the original record fields are final
<b class="nc">&nbsp;                    return new MedicalRecord(record.getRecordId(), record.getPatient(), record.getAppointment(),</b>
<b class="nc">&nbsp;                                             newDiagnosis, newNotes, record.getDate());</b>
&nbsp;                } catch (IllegalArgumentException e) {
<b class="nc">&nbsp;                     showError(&quot;Invalid input: &quot; + e.getMessage());</b>
<b class="nc">&nbsp;                     return null;</b>
&nbsp;                } catch (Exception e) {
<b class="nc">&nbsp;                    showError(&quot;Error processing input: &quot; + e.getMessage());</b>
<b class="nc">&nbsp;                    return null;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return null;</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        Optional&lt;MedicalRecord&gt; result = dialog.showAndWait();</b>
<b class="nc">&nbsp;        result.ifPresent(updatedRecord -&gt; {</b>
&nbsp;            try {
<b class="nc">&nbsp;                controller.updateMedicalRecord(updatedRecord);</b>
<b class="nc">&nbsp;                refreshMedicalRecordList();</b>
&nbsp;            } catch (Exception ex) {
<b class="nc">&nbsp;                showError(&quot;Failed to update medical record: &quot; + ex.getMessage());</b>
<b class="nc">&nbsp;                refreshMedicalRecordList(); // Refresh to show original state</b>
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;     private void showAddMedicalRecordDialog() {
<b class="nc">&nbsp;         Dialog&lt;MedicalRecord&gt; dialog = new Dialog&lt;&gt;();</b>
<b class="nc">&nbsp;        dialog.setTitle(&quot;Add Medical Record&quot;);</b>
<b class="nc">&nbsp;        dialog.setHeaderText(&quot;Enter Record Details&quot;);</b>
&nbsp;
&nbsp;        // Controls
<b class="nc">&nbsp;        ComboBox&lt;Patient&gt; patientCombo = new ComboBox&lt;&gt;(patientList); patientCombo.setPromptText(&quot;Select Patient&quot;);</b>
<b class="nc">&nbsp;        ComboBox&lt;Appointment&gt; appointmentCombo = new ComboBox&lt;&gt;(appointmentList); appointmentCombo.setPromptText(&quot;Select Related Appointment&quot;);</b>
<b class="nc">&nbsp;        DatePicker datePicker = new DatePicker(LocalDate.now());</b>
<b class="nc">&nbsp;        TextField diagnosisField = new TextField(); diagnosisField.setPromptText(&quot;Diagnosis&quot;);</b>
<b class="nc">&nbsp;        TextArea notesArea = new TextArea(); notesArea.setPromptText(&quot;Notes (Optional)&quot;);</b>
<b class="nc">&nbsp;        notesArea.setPrefRowCount(4);</b>
&nbsp;
&nbsp;         // Filter appointments based on selected patient
<b class="nc">&nbsp;        patientCombo.valueProperty().addListener((obs, oldPatient, newPatient) -&gt; {</b>
<b class="nc">&nbsp;            if (newPatient != null) {</b>
<b class="nc">&nbsp;                List&lt;Appointment&gt; patientAppointments = appointmentList.stream()</b>
<b class="nc">&nbsp;                        .filter(a -&gt; a.getPatient().equals(newPatient))</b>
<b class="nc">&nbsp;                        .collect(Collectors.toList());</b>
<b class="nc">&nbsp;                appointmentCombo.setItems(FXCollections.observableArrayList(patientAppointments));</b>
<b class="nc">&nbsp;                appointmentCombo.setDisable(patientAppointments.isEmpty());</b>
<b class="nc">&nbsp;                 if (patientAppointments.isEmpty()) {</b>
<b class="nc">&nbsp;                      appointmentCombo.setPromptText(&quot;No appointments for this patient&quot;);</b>
&nbsp;                 } else {
<b class="nc">&nbsp;                     appointmentCombo.setPromptText(&quot;Select Related Appointment&quot;);</b>
&nbsp;                 }
&nbsp;            } else {
<b class="nc">&nbsp;                appointmentCombo.getItems().clear();</b>
<b class="nc">&nbsp;                appointmentCombo.setDisable(true);</b>
<b class="nc">&nbsp;                appointmentCombo.setPromptText(&quot;Select Patient First&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            appointmentCombo.getSelectionModel().clearSelection(); // Clear selection when patient changes</b>
&nbsp;        });
&nbsp;
&nbsp;        // Layout
<b class="nc">&nbsp;        VBox vbox = new VBox(10, new Label(&quot;Patient:&quot;), patientCombo,</b>
&nbsp;                             new Label(&quot;Appointment:&quot;), appointmentCombo,
&nbsp;                             new Label(&quot;Record Date:&quot;), datePicker,
&nbsp;                             new Label(&quot;Diagnosis:&quot;), diagnosisField,
&nbsp;                             new Label(&quot;Notes:&quot;), notesArea);
<b class="nc">&nbsp;        vbox.setPadding(new Insets(10));</b>
<b class="nc">&nbsp;        dialog.getDialogPane().setContent(vbox);</b>
<b class="nc">&nbsp;        dialog.getDialogPane().getButtonTypes().addAll(ButtonType.OK, ButtonType.CANCEL);</b>
&nbsp;
&nbsp;         // Enable OK only when valid
<b class="nc">&nbsp;        Node okButton = dialog.getDialogPane().lookupButton(ButtonType.OK);</b>
<b class="nc">&nbsp;        okButton.setDisable(true);</b>
<b class="nc">&nbsp;        Runnable updateOkButtonState = () -&gt; {</b>
<b class="nc">&nbsp;             boolean disabled = patientCombo.getValue() == null ||</b>
<b class="nc">&nbsp;                                appointmentCombo.getValue() == null || // Must select an appointment</b>
<b class="nc">&nbsp;                               datePicker.getValue() == null ||</b>
<b class="nc">&nbsp;                               diagnosisField.getText().trim().isEmpty();</b>
<b class="nc">&nbsp;             okButton.setDisable(disabled);</b>
&nbsp;        };
<b class="nc">&nbsp;         patientCombo.valueProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
<b class="nc">&nbsp;         appointmentCombo.valueProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
<b class="nc">&nbsp;         datePicker.valueProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
<b class="nc">&nbsp;         diagnosisField.textProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;         dialog.setResultConverter(dialogButton -&gt; {</b>
<b class="nc">&nbsp;             if (dialogButton == ButtonType.OK) {</b>
&nbsp;                 try {
<b class="nc">&nbsp;                     Patient patient = patientCombo.getValue();</b>
<b class="nc">&nbsp;                     Appointment appointment = appointmentCombo.getValue();</b>
<b class="nc">&nbsp;                     LocalDate date = datePicker.getValue();</b>
<b class="nc">&nbsp;                     String diagnosis = diagnosisField.getText().trim();</b>
<b class="nc">&nbsp;                     String notes = notesArea.getText();</b>
&nbsp;
<b class="nc">&nbsp;                     if (date.isAfter(LocalDate.now())) {</b>
<b class="nc">&nbsp;                         showError(&quot;Record date cannot be in the future.&quot;);</b>
<b class="nc">&nbsp;                         return null;</b>
&nbsp;                     }
&nbsp;
<b class="nc">&nbsp;                     String id = &quot;MR&quot; + (controller.getAllMedicalRecords().size() + 10001); // Simple ID</b>
<b class="nc">&nbsp;                     return new MedicalRecord(id, patient, appointment, diagnosis, notes, date);</b>
&nbsp;                 } catch (NumberFormatException e) {
<b class="nc">&nbsp;                     showError(&quot;Invalid number format for quantity or price.&quot;);</b>
<b class="nc">&nbsp;                     return null;</b>
&nbsp;                 } catch (IllegalArgumentException e) {
<b class="nc">&nbsp;                     showError(&quot;Invalid input: &quot; + e.getMessage());</b>
<b class="nc">&nbsp;                     return null;</b>
&nbsp;                 }
&nbsp;             }
<b class="nc">&nbsp;             return null;</b>
&nbsp;         });
&nbsp;
&nbsp;         // Refresh lists needed for combo boxes
<b class="nc">&nbsp;        refreshPatientList();</b>
<b class="nc">&nbsp;        refreshAppointmentList(); // Need appointments to link</b>
<b class="nc">&nbsp;        if (patientList.isEmpty() || appointmentList.isEmpty()) {</b>
<b class="nc">&nbsp;             showError(&quot;Cannot add record: Patients or Appointments are missing.&quot;);</b>
&nbsp;             return;
&nbsp;        }
<b class="nc">&nbsp;        appointmentCombo.setDisable(true); // Disable until patient selected</b>
&nbsp;
<b class="nc">&nbsp;        Optional&lt;MedicalRecord&gt; result = dialog.showAndWait();</b>
<b class="nc">&nbsp;        result.ifPresent(record -&gt; {</b>
&nbsp;            try {
<b class="nc">&nbsp;                controller.addMedicalRecord(record);</b>
<b class="nc">&nbsp;                refreshMedicalRecordList();</b>
&nbsp;            } catch (Exception ex) {
<b class="nc">&nbsp;                showError(&quot;Failed to add medical record: &quot; + ex.getMessage());</b>
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    private void deleteMedicalRecordAction(MedicalRecord record) {
<b class="nc">&nbsp;         Alert confirm = new Alert(Alert.AlertType.CONFIRMATION,</b>
<b class="nc">&nbsp;                &quot;Are you sure you want to delete medical record &#39;&quot; + record.getRecordId() + &quot;&#39; for patient &#39;&quot; + record.getPatient().getPatientName() + &quot;&#39;?&quot;,</b>
&nbsp;                ButtonType.YES, ButtonType.NO);
<b class="nc">&nbsp;        confirm.setTitle(&quot;Confirm Deletion&quot;);</b>
<b class="nc">&nbsp;        confirm.setHeaderText(null);</b>
&nbsp;
<b class="nc">&nbsp;        confirm.showAndWait().ifPresent(response -&gt; {</b>
<b class="nc">&nbsp;            if (response == ButtonType.YES) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    boolean deleted = controller.deleteMedicalRecord(record.getRecordId());</b>
<b class="nc">&nbsp;                    if (deleted) {</b>
<b class="nc">&nbsp;                        refreshMedicalRecordList();</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        showError(&quot;Medical record could not be found or deleted.&quot;);</b>
&nbsp;                    }
&nbsp;                } catch (Exception ex) {
&nbsp;                    // Catch potential dependencies if inventory is linked elsewhere
<b class="nc">&nbsp;                    showError(&quot;Failed to delete medical record: &quot; + ex.getMessage());</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    // --- Billing (Admin Only) ---
&nbsp;    private void showBilling(Stage stage, String role) {
<b class="nc">&nbsp;        if (!role.equals(&quot;Admin&quot;)) {</b>
<b class="nc">&nbsp;            showError(&quot;Access Denied: Billing is only available for Admins.&quot;);</b>
<b class="nc">&nbsp;            showDashboard(stage, role); // Go back</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        HBox topBar = createTopBar(&quot;Billing Management&quot;, stage, role);</b>
<b class="nc">&nbsp;        HBox searchAddRow = createSearchAddBar(&quot;Search bills by patient or bill ID...&quot;, &quot;Create a new bill&quot;, e -&gt; showAddBillDialog());</b>
<b class="nc">&nbsp;        TextField searchField = getSearchFieldFromBar(searchAddRow);</b>
&nbsp;
<b class="nc">&nbsp;        TableView&lt;Bill&gt; table = createBillingTable();</b>
<b class="nc">&nbsp;        VBox root = createMainScreenLayout(topBar, searchAddRow, table);</b>
&nbsp;
&nbsp;        // Logic
<b class="nc">&nbsp;        refreshBillList();</b>
<b class="nc">&nbsp;        if (searchField != null) {</b>
<b class="nc">&nbsp;            searchField.textProperty().addListener((obs, oldVal, newVal) -&gt; filterBillList(newVal));</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        stage.setTitle(&quot;Hospital System - Billing&quot;);</b>
<b class="nc">&nbsp;        stage.setScene(new Scene(root, 1100, 600));</b>
&nbsp;    }
&nbsp;
&nbsp;    private TableView&lt;Bill&gt; createBillingTable() {
<b class="nc">&nbsp;        TableView&lt;Bill&gt; table = new TableView&lt;&gt;(billList);</b>
<b class="nc">&nbsp;        table.setPrefHeight(420);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;Bill, String&gt; idCol = new TableColumn&lt;&gt;(&quot;Bill ID&quot;);</b>
<b class="nc">&nbsp;        idCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;billId&quot;));</b>
<b class="nc">&nbsp;        idCol.setPrefWidth(100);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;Bill, String&gt; patientNameCol = new TableColumn&lt;&gt;(&quot;Patient Name&quot;);</b>
<b class="nc">&nbsp;        patientNameCol.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getPatient().getPatientName()));</b>
<b class="nc">&nbsp;        patientNameCol.setPrefWidth(150);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;Bill, String&gt; patientIdCol = new TableColumn&lt;&gt;(&quot;Patient ID&quot;);</b>
<b class="nc">&nbsp;        patientIdCol.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getPatient().getPatientId()));</b>
<b class="nc">&nbsp;        patientIdCol.setPrefWidth(100);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;Bill, Double&gt; amountCol = new TableColumn&lt;&gt;(&quot;Total Amount&quot;);</b>
<b class="nc">&nbsp;        amountCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;totalAmount&quot;));</b>
<b class="nc">&nbsp;        amountCol.setPrefWidth(120);</b>
&nbsp;        // Format as currency
<b class="nc">&nbsp;        amountCol.setCellFactory(tc -&gt; new TableCell&lt;Bill, Double&gt;() {</b>
&nbsp;            @Override
&nbsp;            protected void updateItem(Double price, boolean empty) {
<b class="nc">&nbsp;                super.updateItem(price, empty);</b>
<b class="nc">&nbsp;                if (empty || price == null) {</b>
<b class="nc">&nbsp;                    setText(null);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    setText(String.format(&quot;$%.2f&quot;, price));</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
&nbsp;
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;Bill, String&gt; statusCol = new TableColumn&lt;&gt;(&quot;Status&quot;);</b>
<b class="nc">&nbsp;        statusCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;status&quot;));</b>
<b class="nc">&nbsp;        statusCol.setPrefWidth(100);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;Bill, Void&gt; actionsCol = createBillingActionsColumn();</b>
<b class="nc">&nbsp;        actionsCol.setPrefWidth(350); // Wider for more actions</b>
&nbsp;
<b class="nc">&nbsp;        table.getColumns().setAll(idCol, patientNameCol, patientIdCol, amountCol, statusCol, actionsCol);</b>
<b class="nc">&nbsp;        table.setPlaceholder(new Label(&quot;No bills generated yet&quot;));</b>
<b class="nc">&nbsp;        table.setColumnResizePolicy(TableView.CONSTRAINED_RESIZE_POLICY_ALL_COLUMNS);</b>
<b class="nc">&nbsp;        table.setStyle(&quot;-fx-background-color: #f8f8f8; -fx-border-color: #cccccc; -fx-border-radius: 5; -fx-background-radius: 5;&quot;);</b>
<b class="nc">&nbsp;        VBox.setVgrow(table, Priority.ALWAYS);</b>
<b class="nc">&nbsp;        return table;</b>
&nbsp;    }
&nbsp;
&nbsp;     private TableColumn&lt;Bill, Void&gt; createBillingActionsColumn() {
<b class="nc">&nbsp;        TableColumn&lt;Bill, Void&gt; actionsCol = new TableColumn&lt;&gt;(&quot;Actions&quot;);</b>
<b class="nc">&nbsp;        actionsCol.setCellFactory(col -&gt; new TableCell&lt;&gt;() {</b>
<b class="nc">&nbsp;            private final Button viewBtn = new Button(&quot;View Items&quot;);</b>
<b class="nc">&nbsp;            private final Button addLineItemBtn = new Button(&quot;Add Item&quot;);</b>
<b class="nc">&nbsp;            private final Button markPaidBtn = new Button(&quot;Mark Paid&quot;);</b>
<b class="nc">&nbsp;            private final Button deleteBtn = new Button(&quot;Delete&quot;);</b>
&nbsp;            {
<b class="nc">&nbsp;                viewBtn.setOnAction(e -&gt; showBillDetails(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                addLineItemBtn.setOnAction(e -&gt; showAddLineItemDialog(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                markPaidBtn.setOnAction(e -&gt; markBillPaidAction(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                deleteBtn.setOnAction(e -&gt; deleteBillAction(getTableView().getItems().get(getIndex())));</b>
&nbsp;
<b class="nc">&nbsp;                viewBtn.setStyle(BUTTON_STYLE_VIEW);</b>
<b class="nc">&nbsp;                addLineItemBtn.setStyle(BUTTON_STYLE_EDIT); // Reuse edit style</b>
<b class="nc">&nbsp;                markPaidBtn.setStyle(BUTTON_STYLE_ACTION3); // Orangish</b>
<b class="nc">&nbsp;                deleteBtn.setStyle(BUTTON_STYLE_DELETE);</b>
&nbsp;            }
&nbsp;            @Override
&nbsp;            protected void updateItem(Void item, boolean empty) {
<b class="nc">&nbsp;                super.updateItem(item, empty);</b>
<b class="nc">&nbsp;                if (empty || getIndex() &lt; 0 || getIndex() &gt;= getTableView().getItems().size()) {</b>
<b class="nc">&nbsp;                    setGraphic(null);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    Bill bill = getTableView().getItems().get(getIndex());</b>
<b class="nc">&nbsp;                    HBox box = new HBox(6, viewBtn);</b>
<b class="nc">&nbsp;                    if (bill.getStatus() == Bill.Status.UNPAID) {</b>
<b class="nc">&nbsp;                        box.getChildren().addAll(addLineItemBtn, markPaidBtn);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    box.getChildren().add(deleteBtn);</b>
<b class="nc">&nbsp;                    setGraphic(box);</b>
&nbsp;
&nbsp;                    // Disable buttons based on status
<b class="nc">&nbsp;                    addLineItemBtn.setDisable(bill.getStatus() == Bill.Status.PAID);</b>
<b class="nc">&nbsp;                    markPaidBtn.setDisable(bill.getStatus() == Bill.Status.PAID || bill.getTotalAmount() &lt;= 0); // Don&#39;t mark empty bill paid</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;        return actionsCol;</b>
&nbsp;    }
&nbsp;
&nbsp;     private void refreshBillList() {
&nbsp;        try {
<b class="nc">&nbsp;            billList.setAll(controller.getAllBills());</b>
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            showError(&quot;Failed to load bills: &quot; + ex.getMessage());</b>
<b class="nc">&nbsp;            billList.clear();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void filterBillList(String searchText) {
&nbsp;        try {
<b class="nc">&nbsp;            List&lt;Bill&gt; allBills = controller.getAllBills();</b>
<b class="nc">&nbsp;            if (searchText == null || searchText.isEmpty()) {</b>
<b class="nc">&nbsp;                billList.setAll(allBills);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                String lowerCaseFilter = searchText.toLowerCase();</b>
<b class="nc">&nbsp;                billList.setAll(allBills.stream()</b>
<b class="nc">&nbsp;                        .filter(b -&gt; b.getPatient().getPatientName().toLowerCase().contains(lowerCaseFilter) ||</b>
<b class="nc">&nbsp;                                     b.getPatient().getPatientId().toLowerCase().contains(lowerCaseFilter) ||</b>
<b class="nc">&nbsp;                                     b.getBillId().toLowerCase().contains(lowerCaseFilter))</b>
<b class="nc">&nbsp;                        .collect(Collectors.toList()));</b>
&nbsp;            }
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            showError(&quot;Failed to filter bills: &quot; + ex.getMessage());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;     private void showBillDetails(Bill bill) {
<b class="nc">&nbsp;        Alert alert = new Alert(Alert.AlertType.INFORMATION);</b>
<b class="nc">&nbsp;        alert.setTitle(&quot;Bill Details&quot;);</b>
<b class="nc">&nbsp;        alert.setHeaderText(&quot;Bill ID: &quot; + bill.getBillId() + &quot; for Patient: &quot; + bill.getPatient().getPatientName());</b>
&nbsp;
<b class="nc">&nbsp;        TextArea textArea = new TextArea();</b>
<b class="nc">&nbsp;        textArea.setEditable(false);</b>
<b class="nc">&nbsp;        textArea.setWrapText(true);</b>
&nbsp;
<b class="nc">&nbsp;        StringBuilder content = new StringBuilder();</b>
<b class="nc">&nbsp;        content.append(&quot;Patient ID: &quot;).append(bill.getPatient().getPatientId()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        content.append(&quot;Status: &quot;).append(bill.getStatus()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        if (bill.getStatus() == Bill.Status.PAID) {</b>
<b class="nc">&nbsp;             content.append(&quot;Payment Reference: &quot;).append(bill.getPaymentReference()).append(&quot;\n&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        content.append(&quot;\nLine Items:\n&quot;);</b>
<b class="nc">&nbsp;        if (bill.getLineItems().isEmpty()) {</b>
<b class="nc">&nbsp;            content.append(&quot;  (No items added yet)\n&quot;);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            for (Bill.LineItem item : bill.getLineItems()) {</b>
<b class="nc">&nbsp;                content.append(String.format(&quot;  - %s: $%.2f\n&quot;, item.getDescription(), item.getAmount()));</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        content.append(&quot;\n--------------------\n&quot;);</b>
<b class="nc">&nbsp;        content.append(String.format(&quot;Total Amount: $%.2f\n&quot;, bill.getTotalAmount()));</b>
&nbsp;
<b class="nc">&nbsp;        textArea.setText(content.toString());</b>
<b class="nc">&nbsp;        textArea.setPrefRowCount(15);</b>
<b class="nc">&nbsp;        textArea.setPrefColumnCount(50);</b>
&nbsp;
<b class="nc">&nbsp;        alert.getDialogPane().setContent(textArea);</b>
<b class="nc">&nbsp;        alert.setResizable(true);</b>
<b class="nc">&nbsp;        alert.showAndWait();</b>
&nbsp;    }
&nbsp;
&nbsp;     private void showAddBillDialog() {
&nbsp;         // A bill needs a patient. Create an unpaid bill for a patient first.
<b class="nc">&nbsp;         Dialog&lt;Patient&gt; dialog = new Dialog&lt;&gt;();</b>
<b class="nc">&nbsp;         dialog.setTitle(&quot;Create New Bill&quot;);</b>
<b class="nc">&nbsp;         dialog.setHeaderText(&quot;Select Patient for New Bill&quot;);</b>
&nbsp;
<b class="nc">&nbsp;         ComboBox&lt;Patient&gt; patientCombo = new ComboBox&lt;&gt;(patientList);</b>
<b class="nc">&nbsp;         patientCombo.setPromptText(&quot;Select Patient&quot;);</b>
&nbsp;
<b class="nc">&nbsp;         VBox vbox = new VBox(10, new Label(&quot;Patient:&quot;), patientCombo);</b>
<b class="nc">&nbsp;         vbox.setPadding(new Insets(10));</b>
<b class="nc">&nbsp;         dialog.getDialogPane().setContent(vbox);</b>
<b class="nc">&nbsp;         dialog.getDialogPane().getButtonTypes().addAll(ButtonType.OK, ButtonType.CANCEL);</b>
&nbsp;
&nbsp;         // Enable OK only when patient selected
<b class="nc">&nbsp;         Node okButton = dialog.getDialogPane().lookupButton(ButtonType.OK);</b>
<b class="nc">&nbsp;         okButton.setDisable(true);</b>
<b class="nc">&nbsp;         patientCombo.valueProperty().addListener((obs, o, n) -&gt; okButton.setDisable(n == null));</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;         dialog.setResultConverter(dialogButton -&gt; dialogButton == ButtonType.OK ? patientCombo.getValue() : null);</b>
&nbsp;
&nbsp;         // Refresh patient list
<b class="nc">&nbsp;         refreshPatientList();</b>
<b class="nc">&nbsp;         if (patientList.isEmpty()) {</b>
<b class="nc">&nbsp;              showError(&quot;Cannot create bill: No patients registered.&quot;);</b>
&nbsp;              return;
&nbsp;         }
&nbsp;
&nbsp;
<b class="nc">&nbsp;         Optional&lt;Patient&gt; result = dialog.showAndWait();</b>
<b class="nc">&nbsp;         result.ifPresent(patient -&gt; {</b>
&nbsp;             try {
<b class="nc">&nbsp;                 String id = &quot;B&quot; + (controller.getAllBills().size() + 101); // Simple ID</b>
<b class="nc">&nbsp;                 Bill newBill = new Bill(id, patient); // Creates an empty, unpaid bill</b>
<b class="nc">&nbsp;                 controller.createBill(newBill);</b>
<b class="nc">&nbsp;                 refreshBillList();</b>
&nbsp;             } catch (Exception ex) {
<b class="nc">&nbsp;                 showError(&quot;Failed to create bill: &quot; + ex.getMessage());</b>
&nbsp;             }
&nbsp;         });
&nbsp;    }
&nbsp;
&nbsp;     private void showAddLineItemDialog(Bill bill) {
<b class="nc">&nbsp;         if (bill.getStatus() == Bill.Status.PAID) {</b>
<b class="nc">&nbsp;             showError(&quot;Cannot add items to a paid bill.&quot;);</b>
&nbsp;             return;
&nbsp;         }
&nbsp;
<b class="nc">&nbsp;         Dialog&lt;Bill.LineItem&gt; dialog = new Dialog&lt;&gt;();</b>
<b class="nc">&nbsp;         dialog.setTitle(&quot;Add Line Item&quot;);</b>
<b class="nc">&nbsp;         dialog.setHeaderText(&quot;Add Item to Bill ID: &quot; + bill.getBillId());</b>
&nbsp;
<b class="nc">&nbsp;         TextField descriptionField = new TextField(); descriptionField.setPromptText(&quot;Item Description&quot;);</b>
<b class="nc">&nbsp;         TextField amountField = new TextField(); amountField.setPromptText(&quot;Amount (e.g., 12.50)&quot;);</b>
&nbsp;
&nbsp;         // Basic numeric validation listener
<b class="nc">&nbsp;         amountField.textProperty().addListener((observable, oldValue, newValue) -&gt; {</b>
<b class="nc">&nbsp;             if (!newValue.matches(&quot;\\d*([.]\\d{0,2})?&quot;)) {</b>
<b class="nc">&nbsp;                 amountField.setText(oldValue);</b>
&nbsp;             }
&nbsp;         });
&nbsp;
<b class="nc">&nbsp;         VBox vbox = new VBox(10, new Label(&quot;Description:&quot;), descriptionField, new Label(&quot;Amount ($):&quot;), amountField);</b>
<b class="nc">&nbsp;         vbox.setPadding(new Insets(10));</b>
<b class="nc">&nbsp;         dialog.getDialogPane().setContent(vbox);</b>
<b class="nc">&nbsp;         dialog.getDialogPane().getButtonTypes().addAll(ButtonType.OK, ButtonType.CANCEL);</b>
&nbsp;
&nbsp;
&nbsp;          // Enable OK only when valid
<b class="nc">&nbsp;        Node okButton = dialog.getDialogPane().lookupButton(ButtonType.OK);</b>
<b class="nc">&nbsp;        okButton.setDisable(true);</b>
<b class="nc">&nbsp;        Runnable updateOkButtonState = () -&gt; {</b>
<b class="nc">&nbsp;             boolean disabled = descriptionField.getText().trim().isEmpty() ||</b>
<b class="nc">&nbsp;                                amountField.getText().trim().isEmpty();</b>
&nbsp;             try {
<b class="nc">&nbsp;                 if (!disabled) Double.parseDouble(amountField.getText()); // Check if valid double</b>
&nbsp;             } catch (NumberFormatException e) {
<b class="nc">&nbsp;                 disabled = true;</b>
&nbsp;             }
<b class="nc">&nbsp;             okButton.setDisable(disabled);</b>
&nbsp;        };
<b class="nc">&nbsp;        descriptionField.textProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
<b class="nc">&nbsp;        amountField.textProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;         dialog.setResultConverter(dialogButton -&gt; {</b>
<b class="nc">&nbsp;             if (dialogButton == ButtonType.OK) {</b>
&nbsp;                 try {
<b class="nc">&nbsp;                     String description = descriptionField.getText().trim();</b>
<b class="nc">&nbsp;                     double amount = Double.parseDouble(amountField.getText());</b>
<b class="nc">&nbsp;                     return new Bill.LineItem(description, amount);</b>
&nbsp;                 } catch (NumberFormatException e) {
<b class="nc">&nbsp;                     showError(&quot;Invalid amount format.&quot;);</b>
<b class="nc">&nbsp;                     return null;</b>
&nbsp;                 } catch (IllegalArgumentException e) {
<b class="nc">&nbsp;                      showError(&quot;Invalid input: &quot; + e.getMessage());</b>
<b class="nc">&nbsp;                      return null;</b>
&nbsp;                 }
&nbsp;             }
<b class="nc">&nbsp;             return null;</b>
&nbsp;         });
&nbsp;
<b class="nc">&nbsp;         Optional&lt;Bill.LineItem&gt; result = dialog.showAndWait();</b>
<b class="nc">&nbsp;         result.ifPresent(lineItem -&gt; {</b>
&nbsp;             try {
<b class="nc">&nbsp;                 bill.addLineItem(lineItem); // Add to local object</b>
<b class="nc">&nbsp;                 controller.updateBill(bill); // Persist change</b>
<b class="nc">&nbsp;                 refreshBillList(); // Refresh table</b>
&nbsp;             } catch (Exception ex) {
<b class="nc">&nbsp;                 showError(&quot;Failed to add line item: &quot; + ex.getMessage());</b>
<b class="nc">&nbsp;                 refreshBillList();</b>
&nbsp;             }
&nbsp;         });
&nbsp;    }
&nbsp;
&nbsp;    private void markBillPaidAction(Bill bill) {
<b class="nc">&nbsp;         if (bill.getStatus() == Bill.Status.PAID) {</b>
<b class="nc">&nbsp;             showError(&quot;Bill is already marked as paid.&quot;);</b>
&nbsp;             return;
&nbsp;         }
<b class="nc">&nbsp;          if (bill.getTotalAmount() &lt;= 0) {</b>
<b class="nc">&nbsp;             showError(&quot;Cannot mark an empty or zero-amount bill as paid.&quot;);</b>
&nbsp;             return;
&nbsp;         }
&nbsp;
&nbsp;
<b class="nc">&nbsp;         TextInputDialog dialog = new TextInputDialog();</b>
<b class="nc">&nbsp;         dialog.setTitle(&quot;Mark Bill as Paid&quot;);</b>
<b class="nc">&nbsp;         dialog.setHeaderText(&quot;Enter Payment Reference for Bill ID: &quot; + bill.getBillId());</b>
<b class="nc">&nbsp;         dialog.setContentText(&quot;Payment Reference:&quot;);</b>
&nbsp;
<b class="nc">&nbsp;         Optional&lt;String&gt; result = dialog.showAndWait();</b>
<b class="nc">&nbsp;         result.ifPresent(reference -&gt; {</b>
<b class="nc">&nbsp;             if (reference.trim().isEmpty()) {</b>
<b class="nc">&nbsp;                 showError(&quot;Payment reference cannot be empty.&quot;);</b>
&nbsp;                 return;
&nbsp;             }
&nbsp;             try {
<b class="nc">&nbsp;                 controller.markBillAsPaid(bill.getBillId(), reference.trim()); // Use controller/service</b>
<b class="nc">&nbsp;                 refreshBillList(); // Refresh table</b>
&nbsp;             } catch (IllegalArgumentException | IllegalStateException e) {
<b class="nc">&nbsp;                 showError(&quot;Could not mark bill as paid: &quot; + e.getMessage());</b>
<b class="nc">&nbsp;                 refreshBillList();</b>
&nbsp;             } catch (Exception ex) {
<b class="nc">&nbsp;                  showError(&quot;An unexpected error occurred: &quot; + ex.getMessage());</b>
<b class="nc">&nbsp;                  refreshBillList();</b>
&nbsp;             }
&nbsp;         });
&nbsp;    }
&nbsp;
&nbsp;     private void deleteBillAction(Bill bill) {
<b class="nc">&nbsp;          Alert confirm = new Alert(Alert.AlertType.CONFIRMATION,</b>
<b class="nc">&nbsp;                &quot;Are you sure you want to delete bill &#39;&quot; + bill.getBillId() + &quot;&#39; for patient &#39;&quot; + bill.getPatient().getPatientName() + &quot;&#39;?&quot;,</b>
&nbsp;                ButtonType.YES, ButtonType.NO);
<b class="nc">&nbsp;        confirm.setTitle(&quot;Confirm Deletion&quot;);</b>
<b class="nc">&nbsp;        confirm.setHeaderText(null);</b>
&nbsp;
<b class="nc">&nbsp;        confirm.showAndWait().ifPresent(response -&gt; {</b>
<b class="nc">&nbsp;            if (response == ButtonType.YES) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    boolean deleted = controller.deleteBill(bill.getBillId());</b>
<b class="nc">&nbsp;                    if (deleted) {</b>
<b class="nc">&nbsp;                        refreshBillList();</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        showError(&quot;Bill could not be found or deleted.&quot;);</b>
&nbsp;                    }
&nbsp;                } catch (Exception ex) {
<b class="nc">&nbsp;                    showError(&quot;Failed to delete bill: &quot; + ex.getMessage());</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    // --- Inventory (Admin Only) ---
&nbsp;    private void showInventory(Stage stage, String role) {
<b class="nc">&nbsp;         if (!role.equals(&quot;Admin&quot;)) {</b>
<b class="nc">&nbsp;            showError(&quot;Access Denied: Inventory is only available for Admins.&quot;);</b>
<b class="nc">&nbsp;            showDashboard(stage, role); // Go back</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;         HBox topBar = createTopBar(&quot;Inventory Management&quot;, stage, role);</b>
<b class="nc">&nbsp;         HBox searchAddRow = createSearchAddBar(&quot;Search inventory by name or ID...&quot;, &quot;Add a new inventory item&quot;, e -&gt; showAddInventoryItemDialog());</b>
<b class="nc">&nbsp;         TextField searchField = getSearchFieldFromBar(searchAddRow);</b>
&nbsp;
<b class="nc">&nbsp;         TableView&lt;InventoryItem&gt; table = createInventoryTable();</b>
<b class="nc">&nbsp;         VBox root = createMainScreenLayout(topBar, searchAddRow, table);</b>
&nbsp;
&nbsp;         // Logic
<b class="nc">&nbsp;         refreshInventoryList();</b>
<b class="nc">&nbsp;         if (searchField != null) {</b>
<b class="nc">&nbsp;             searchField.textProperty().addListener((obs, oldVal, newVal) -&gt; filterInventoryList(newVal));</b>
&nbsp;         }
&nbsp;
<b class="nc">&nbsp;         stage.setTitle(&quot;Hospital System - Inventory&quot;);</b>
<b class="nc">&nbsp;         stage.setScene(new Scene(root, 1100, 600));</b>
&nbsp;    }
&nbsp;
&nbsp;     private TableView&lt;InventoryItem&gt; createInventoryTable() {
<b class="nc">&nbsp;        TableView&lt;InventoryItem&gt; table = new TableView&lt;&gt;(inventoryList);</b>
<b class="nc">&nbsp;        table.setPrefHeight(420);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;InventoryItem, String&gt; idCol = new TableColumn&lt;&gt;(&quot;Item ID&quot;);</b>
<b class="nc">&nbsp;        idCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;itemId&quot;));</b>
<b class="nc">&nbsp;        idCol.setPrefWidth(100);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;InventoryItem, String&gt; nameCol = new TableColumn&lt;&gt;(&quot;Name&quot;);</b>
<b class="nc">&nbsp;        nameCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;name&quot;));</b>
<b class="nc">&nbsp;        nameCol.setPrefWidth(250);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;InventoryItem, Integer&gt; quantityCol = new TableColumn&lt;&gt;(&quot;Quantity&quot;);</b>
<b class="nc">&nbsp;        quantityCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;quantity&quot;));</b>
<b class="nc">&nbsp;        quantityCol.setPrefWidth(100);</b>
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;InventoryItem, Double&gt; priceCol = new TableColumn&lt;&gt;(&quot;Unit Price&quot;);</b>
<b class="nc">&nbsp;        priceCol.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;unitPrice&quot;));</b>
<b class="nc">&nbsp;        priceCol.setPrefWidth(120);</b>
&nbsp;         // Format as currency
<b class="nc">&nbsp;        priceCol.setCellFactory(tc -&gt; new TableCell&lt;InventoryItem, Double&gt;() {</b>
&nbsp;            @Override
&nbsp;            protected void updateItem(Double price, boolean empty) {
<b class="nc">&nbsp;                super.updateItem(price, empty);</b>
<b class="nc">&nbsp;                if (empty || price == null) {</b>
<b class="nc">&nbsp;                    setText(null);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    setText(String.format(&quot;$%.2f&quot;, price));</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        TableColumn&lt;InventoryItem, Void&gt; actionsCol = createInventoryActionsColumn();</b>
<b class="nc">&nbsp;        actionsCol.setPrefWidth(250); // Adjust width as needed</b>
&nbsp;
<b class="nc">&nbsp;        table.getColumns().setAll(idCol, nameCol, quantityCol, priceCol, actionsCol);</b>
<b class="nc">&nbsp;        table.setPlaceholder(new Label(&quot;No inventory items found&quot;));</b>
<b class="nc">&nbsp;        table.setColumnResizePolicy(TableView.CONSTRAINED_RESIZE_POLICY_ALL_COLUMNS);</b>
<b class="nc">&nbsp;        table.setStyle(&quot;-fx-background-color: #f8f8f8; -fx-border-color: #cccccc; -fx-border-radius: 5; -fx-background-radius: 5;&quot;);</b>
<b class="nc">&nbsp;        VBox.setVgrow(table, Priority.ALWAYS);</b>
<b class="nc">&nbsp;        return table;</b>
&nbsp;    }
&nbsp;
&nbsp;     private TableColumn&lt;InventoryItem, Void&gt; createInventoryActionsColumn() {
<b class="nc">&nbsp;        TableColumn&lt;InventoryItem, Void&gt; actionsCol = new TableColumn&lt;&gt;(&quot;Actions&quot;);</b>
<b class="nc">&nbsp;        actionsCol.setCellFactory(col -&gt; new TableCell&lt;&gt;() {</b>
<b class="nc">&nbsp;            private final Button editBtn = new Button(&quot;Edit&quot;);</b>
<b class="nc">&nbsp;            private final Button deleteBtn = new Button(&quot;Delete&quot;);</b>
<b class="nc">&nbsp;            private final Button addStockBtn = new Button(&quot;+ Stock&quot;);</b>
<b class="nc">&nbsp;            private final Button removeStockBtn = new Button(&quot;- Stock&quot;);</b>
&nbsp;             {
<b class="nc">&nbsp;                editBtn.setOnAction(e -&gt; showEditInventoryItemDialog(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                deleteBtn.setOnAction(e -&gt; deleteInventoryItemAction(getTableView().getItems().get(getIndex())));</b>
<b class="nc">&nbsp;                addStockBtn.setOnAction(e -&gt; showUpdateStockDialog(getTableView().getItems().get(getIndex()), true)); // true for add</b>
<b class="nc">&nbsp;                removeStockBtn.setOnAction(e -&gt; showUpdateStockDialog(getTableView().getItems().get(getIndex()), false)); // false for remove</b>
&nbsp;
<b class="nc">&nbsp;                editBtn.setStyle(BUTTON_STYLE_EDIT);</b>
<b class="nc">&nbsp;                deleteBtn.setStyle(BUTTON_STYLE_DELETE);</b>
<b class="nc">&nbsp;                addStockBtn.setStyle(BUTTON_STYLE_ACTION1); // Greenish</b>
<b class="nc">&nbsp;                removeStockBtn.setStyle(BUTTON_STYLE_ACTION2); // Bluish</b>
&nbsp;            }
&nbsp;            @Override
&nbsp;            protected void updateItem(Void item, boolean empty) {
<b class="nc">&nbsp;                super.updateItem(item, empty);</b>
<b class="nc">&nbsp;                if (empty) {</b>
<b class="nc">&nbsp;                    setGraphic(null);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    InventoryItem invItem = getTableView().getItems().get(getIndex());</b>
<b class="nc">&nbsp;                    HBox box = new HBox(6, editBtn, deleteBtn, addStockBtn, removeStockBtn);</b>
&nbsp;                    // Disable remove stock if quantity is 0
<b class="nc">&nbsp;                    removeStockBtn.setDisable(invItem.getQuantity() &lt;= 0);</b>
<b class="nc">&nbsp;                    setGraphic(box);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;        return actionsCol;</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    private void refreshInventoryList() {
&nbsp;        try {
<b class="nc">&nbsp;            inventoryList.setAll(controller.getAllInventoryItems());</b>
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            showError(&quot;Failed to load inventory: &quot; + ex.getMessage());</b>
<b class="nc">&nbsp;            inventoryList.clear();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;     private void filterInventoryList(String searchText) {
&nbsp;        try {
<b class="nc">&nbsp;            List&lt;InventoryItem&gt; allItems = controller.getAllInventoryItems();</b>
<b class="nc">&nbsp;            if (searchText == null || searchText.isEmpty()) {</b>
<b class="nc">&nbsp;                inventoryList.setAll(allItems);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                String lowerCaseFilter = searchText.toLowerCase();</b>
<b class="nc">&nbsp;                inventoryList.setAll(allItems.stream()</b>
<b class="nc">&nbsp;                        .filter(i -&gt; i.getName().toLowerCase().contains(lowerCaseFilter) ||</b>
<b class="nc">&nbsp;                                     i.getItemId().toLowerCase().contains(lowerCaseFilter))</b>
<b class="nc">&nbsp;                        .collect(Collectors.toList()));</b>
&nbsp;            }
&nbsp;        } catch (Exception ex) {
<b class="nc">&nbsp;            showError(&quot;Failed to filter inventory: &quot; + ex.getMessage());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;     private void showAddInventoryItemDialog() {
<b class="nc">&nbsp;        Dialog&lt;InventoryItem&gt; dialog = new Dialog&lt;&gt;();</b>
<b class="nc">&nbsp;        dialog.setTitle(&quot;Add Inventory Item&quot;);</b>
<b class="nc">&nbsp;        dialog.setHeaderText(&quot;Enter New Item Details&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        TextField nameField = new TextField(); nameField.setPromptText(&quot;Item Name&quot;);</b>
<b class="nc">&nbsp;        TextField quantityField = new TextField(); quantityField.setPromptText(&quot;Initial Quantity&quot;);</b>
<b class="nc">&nbsp;        TextField priceField = new TextField(); priceField.setPromptText(&quot;Unit Price (e.g., 5.99)&quot;);</b>
&nbsp;
&nbsp;        // Numeric validation
<b class="nc">&nbsp;        quantityField.textProperty().addListener((obs, ov, nv) -&gt; { if (!nv.matches(&quot;\\d*&quot;)) quantityField.setText(ov); });</b>
<b class="nc">&nbsp;        priceField.textProperty().addListener((obs, ov, nv) -&gt; { if (!nv.matches(&quot;\\d*([.]\\d{0,2})?&quot;)) priceField.setText(ov); });</b>
&nbsp;
<b class="nc">&nbsp;        VBox vbox = new VBox(10, new Label(&quot;Name:&quot;), nameField, new Label(&quot;Quantity:&quot;), quantityField, new Label(&quot;Unit Price ($):&quot;), priceField);</b>
<b class="nc">&nbsp;        vbox.setPadding(new Insets(10));</b>
<b class="nc">&nbsp;        dialog.getDialogPane().setContent(vbox);</b>
<b class="nc">&nbsp;        dialog.getDialogPane().getButtonTypes().addAll(ButtonType.OK, ButtonType.CANCEL);</b>
&nbsp;
&nbsp;        // Enable OK only when valid
<b class="nc">&nbsp;        Node okButton = dialog.getDialogPane().lookupButton(ButtonType.OK);</b>
<b class="nc">&nbsp;        okButton.setDisable(true);</b>
<b class="nc">&nbsp;         Runnable updateOkButtonState = () -&gt; {</b>
<b class="nc">&nbsp;             boolean disabled = nameField.getText().trim().isEmpty() ||</b>
<b class="nc">&nbsp;                                quantityField.getText().trim().isEmpty() ||</b>
<b class="nc">&nbsp;                                priceField.getText().trim().isEmpty();</b>
&nbsp;             try {
<b class="nc">&nbsp;                 if (!disabled) {</b>
<b class="nc">&nbsp;                     Integer.parseInt(quantityField.getText());</b>
<b class="nc">&nbsp;                     Double.parseDouble(priceField.getText());</b>
&nbsp;                 }
&nbsp;             } catch (NumberFormatException e) {
<b class="nc">&nbsp;                 disabled = true;</b>
&nbsp;             }
<b class="nc">&nbsp;             okButton.setDisable(disabled);</b>
&nbsp;        };
<b class="nc">&nbsp;        nameField.textProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
<b class="nc">&nbsp;        quantityField.textProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
<b class="nc">&nbsp;        priceField.textProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;        dialog.setResultConverter(dialogButton -&gt; {</b>
<b class="nc">&nbsp;            if (dialogButton == ButtonType.OK) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    String name = nameField.getText().trim();</b>
<b class="nc">&nbsp;                    int quantity = Integer.parseInt(quantityField.getText());</b>
<b class="nc">&nbsp;                    double price = Double.parseDouble(priceField.getText());</b>
<b class="nc">&nbsp;                    String id = &quot;INV&quot; + (controller.getAllInventoryItems().size() + 101); // Simple ID</b>
<b class="nc">&nbsp;                    return new InventoryItem(id, name, quantity, price);</b>
&nbsp;                } catch (NumberFormatException e) {
<b class="nc">&nbsp;                    showError(&quot;Invalid number format for quantity or price.&quot;);</b>
<b class="nc">&nbsp;                    return null;</b>
&nbsp;                } catch (IllegalArgumentException e) {
<b class="nc">&nbsp;                    showError(&quot;Invalid input: &quot; + e.getMessage());</b>
<b class="nc">&nbsp;                    return null;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return null;</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        Optional&lt;InventoryItem&gt; result = dialog.showAndWait();</b>
<b class="nc">&nbsp;        result.ifPresent(item -&gt; {</b>
&nbsp;            try {
<b class="nc">&nbsp;                controller.addInventoryItem(item);</b>
<b class="nc">&nbsp;                refreshInventoryList();</b>
&nbsp;            } catch (Exception ex) {
<b class="nc">&nbsp;                showError(&quot;Failed to add inventory item: &quot; + ex.getMessage());</b>
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;     private void showEditInventoryItemDialog(InventoryItem item) {
<b class="nc">&nbsp;        Dialog&lt;InventoryItem&gt; dialog = new Dialog&lt;&gt;();</b>
<b class="nc">&nbsp;        dialog.setTitle(&quot;Edit Inventory Item&quot;);</b>
<b class="nc">&nbsp;        dialog.setHeaderText(&quot;Edit Details for Item ID: &quot; + item.getItemId());</b>
&nbsp;
<b class="nc">&nbsp;        TextField nameField = new TextField(item.getName());</b>
<b class="nc">&nbsp;        TextField priceField = new TextField(String.format(&quot;%.2f&quot;, item.getUnitPrice()));</b>
&nbsp;
&nbsp;        // Numeric validation
<b class="nc">&nbsp;        priceField.textProperty().addListener((obs, ov, nv) -&gt; { if (!nv.matches(&quot;\\d*([.]\\d{0,2})?&quot;)) priceField.setText(ov); });</b>
&nbsp;
<b class="nc">&nbsp;        VBox vbox = new VBox(10, new Label(&quot;Name:&quot;), nameField, new Label(&quot;Unit Price ($):&quot;), priceField);</b>
<b class="nc">&nbsp;        vbox.setPadding(new Insets(10));</b>
<b class="nc">&nbsp;        dialog.getDialogPane().setContent(vbox);</b>
<b class="nc">&nbsp;        dialog.getDialogPane().getButtonTypes().addAll(ButtonType.OK, ButtonType.CANCEL);</b>
&nbsp;
&nbsp;        // Enable OK only when valid
<b class="nc">&nbsp;        Node okButton = dialog.getDialogPane().lookupButton(ButtonType.OK);</b>
<b class="nc">&nbsp;        okButton.setDisable(false); // Start enabled as fields are pre-filled</b>
<b class="nc">&nbsp;         Runnable updateOkButtonState = () -&gt; {</b>
<b class="nc">&nbsp;             boolean disabled = nameField.getText().trim().isEmpty() ||</b>
<b class="nc">&nbsp;                                priceField.getText().trim().isEmpty();</b>
&nbsp;             try {
<b class="nc">&nbsp;                 if (!disabled) {</b>
<b class="nc">&nbsp;                     Double.parseDouble(priceField.getText());</b>
&nbsp;                 }
&nbsp;             } catch (NumberFormatException e) {
<b class="nc">&nbsp;                 disabled = true;</b>
&nbsp;             }
<b class="nc">&nbsp;             okButton.setDisable(disabled);</b>
&nbsp;        };
<b class="nc">&nbsp;        nameField.textProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
<b class="nc">&nbsp;        priceField.textProperty().addListener((obs, o, n) -&gt; updateOkButtonState.run());</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;        dialog.setResultConverter(dialogButton -&gt; {</b>
<b class="nc">&nbsp;            if (dialogButton == ButtonType.OK) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    String newName = nameField.getText().trim();</b>
<b class="nc">&nbsp;                    double newPrice = Double.parseDouble(priceField.getText());</b>
&nbsp;
&nbsp;                    // Apply changes locally first for validation by setters
<b class="nc">&nbsp;                    item.setName(newName);</b>
<b class="nc">&nbsp;                    item.setUnitPrice(newPrice);</b>
&nbsp;
<b class="nc">&nbsp;                    return item; // Return the modified item</b>
&nbsp;                } catch (NumberFormatException e) {
<b class="nc">&nbsp;                    showError(&quot;Invalid number format for price.&quot;);</b>
<b class="nc">&nbsp;                    return null;</b>
&nbsp;                } catch (IllegalArgumentException e) {
<b class="nc">&nbsp;                    showError(&quot;Invalid input: &quot; + e.getMessage());</b>
<b class="nc">&nbsp;                    return null;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return null;</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        Optional&lt;InventoryItem&gt; result = dialog.showAndWait();</b>
<b class="nc">&nbsp;        result.ifPresent(updatedItem -&gt; {</b>
&nbsp;            try {
<b class="nc">&nbsp;                controller.updateInventoryItem(updatedItem);</b>
<b class="nc">&nbsp;                refreshInventoryList();</b>
&nbsp;            } catch (Exception ex) {
<b class="nc">&nbsp;                showError(&quot;Failed to update inventory item: &quot; + ex.getMessage());</b>
<b class="nc">&nbsp;                refreshInventoryList(); // Refresh to show original state</b>
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;     private void showUpdateStockDialog(InventoryItem item, boolean isAdding) {
<b class="nc">&nbsp;         String action = isAdding ? &quot;Add&quot; : &quot;Remove&quot;;</b>
<b class="nc">&nbsp;         Dialog&lt;Integer&gt; dialog = new Dialog&lt;&gt;();</b>
<b class="nc">&nbsp;         dialog.setTitle(action + &quot; Stock&quot;);</b>
<b class="nc">&nbsp;         dialog.setHeaderText(action + &quot; Stock for &quot; + item.getName() + &quot; (Current: &quot; + item.getQuantity() + &quot;)&quot;);</b>
&nbsp;
<b class="nc">&nbsp;         TextField amountField = new TextField();</b>
<b class="nc">&nbsp;         amountField.setPromptText(&quot;Enter amount&quot;);</b>
&nbsp;         // Integer validation
<b class="nc">&nbsp;         amountField.textProperty().addListener((obs, ov, nv) -&gt; { if (!nv.matches(&quot;\\d*&quot;)) amountField.setText(ov); });</b>
&nbsp;
<b class="nc">&nbsp;         VBox content = new VBox(10, dialog.getDialogPane().getContent(), amountField);</b>
<b class="nc">&nbsp;         dialog.getDialogPane().setContent(content);</b>
<b class="nc">&nbsp;         dialog.getDialogPane().getButtonTypes().addAll(ButtonType.OK, ButtonType.CANCEL);</b>
&nbsp;
&nbsp;         // Enable OK only when valid integer &gt; 0 entered
<b class="nc">&nbsp;         Node okButton = dialog.getDialogPane().lookupButton(ButtonType.OK);</b>
<b class="nc">&nbsp;         okButton.setDisable(true);</b>
<b class="nc">&nbsp;         amountField.textProperty().addListener((obs, ov, nv) -&gt; {</b>
<b class="nc">&nbsp;             boolean disabled = true;</b>
&nbsp;             try {
<b class="nc">&nbsp;                 int amount = Integer.parseInt(nv);</b>
<b class="nc">&nbsp;                 if (amount &gt; 0) {</b>
<b class="nc">&nbsp;                     if (!isAdding &amp;&amp; amount &gt; item.getQuantity()) {</b>
&nbsp;                         // Handled by logic later, but keep button enabled
<b class="nc">&nbsp;                          disabled = false;</b>
&nbsp;                     } else {
<b class="nc">&nbsp;                          disabled = false;</b>
&nbsp;                     }
&nbsp;                 }
&nbsp;             } catch (NumberFormatException e) {
&nbsp;                 // Keep disabled
&nbsp;             }
<b class="nc">&nbsp;             okButton.setDisable(disabled);</b>
&nbsp;         });
&nbsp;
<b class="nc">&nbsp;         dialog.setResultConverter(dialogButton -&gt; {</b>
<b class="nc">&nbsp;             if (dialogButton == ButtonType.OK) {</b>
&nbsp;                 try {
<b class="nc">&nbsp;                     return Integer.parseInt(amountField.getText());</b>
&nbsp;                 } catch (NumberFormatException e) {
&nbsp;                     // Should not happen due to validation, but handle defensively
<b class="nc">&nbsp;                     showError(&quot;Invalid amount entered.&quot;);</b>
<b class="nc">&nbsp;                     return null;</b>
&nbsp;                 }
&nbsp;             }
<b class="nc">&nbsp;             return null;</b>
&nbsp;         });
&nbsp;
<b class="nc">&nbsp;         Optional&lt;Integer&gt; result = dialog.showAndWait();</b>
<b class="nc">&nbsp;         result.ifPresent(amount -&gt; {</b>
&nbsp;             try {
<b class="nc">&nbsp;                 if (isAdding) {</b>
<b class="nc">&nbsp;                     item.addStock(amount);</b>
&nbsp;                 } else {
<b class="nc">&nbsp;                     item.removeStock(amount);</b>
&nbsp;                 }
<b class="nc">&nbsp;                 controller.updateInventoryItem(item); // Persist change</b>
<b class="nc">&nbsp;                 refreshInventoryList();</b>
&nbsp;             } catch (IllegalArgumentException e) {
<b class="nc">&nbsp;                 showError(&quot;Failed to update stock: &quot; + e.getMessage());</b>
<b class="nc">&nbsp;                 refreshInventoryList(); // Refresh view</b>
&nbsp;             } catch (Exception ex) {
<b class="nc">&nbsp;                  showError(&quot;An unexpected error occurred: &quot; + ex.getMessage());</b>
<b class="nc">&nbsp;                  refreshInventoryList();</b>
&nbsp;             }
&nbsp;         });
&nbsp;     }
&nbsp;
&nbsp;
&nbsp;    private void deleteInventoryItemAction(InventoryItem item) {
<b class="nc">&nbsp;         Alert confirm = new Alert(Alert.AlertType.CONFIRMATION,</b>
<b class="nc">&nbsp;                &quot;Are you sure you want to delete inventory item &#39;&quot; + item.getName() + &quot;&#39; (ID: &quot; + item.getItemId() + &quot;)?&quot;,</b>
&nbsp;                ButtonType.YES, ButtonType.NO);
<b class="nc">&nbsp;        confirm.setTitle(&quot;Confirm Deletion&quot;);</b>
<b class="nc">&nbsp;        confirm.setHeaderText(null);</b>
&nbsp;
<b class="nc">&nbsp;        confirm.showAndWait().ifPresent(response -&gt; {</b>
<b class="nc">&nbsp;            if (response == ButtonType.YES) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    boolean deleted = controller.deleteInventoryItem(item.getItemId());</b>
<b class="nc">&nbsp;                    if (deleted) {</b>
<b class="nc">&nbsp;                        refreshInventoryList();</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        showError(&quot;Inventory item could not be found or deleted.&quot;);</b>
&nbsp;                    }
&nbsp;                } catch (Exception ex) {
&nbsp;                    // Catch potential dependencies if inventory is linked elsewhere
<b class="nc">&nbsp;                    showError(&quot;Failed to delete inventory item: &quot; + ex.getMessage());</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    // --- Utility ---
&nbsp;    private void showError(String msg) {
<b class="nc">&nbsp;        Alert alert = new Alert(Alert.AlertType.ERROR, msg, ButtonType.OK);</b>
<b class="nc">&nbsp;        alert.setTitle(&quot;Error&quot;);</b>
<b class="nc">&nbsp;        alert.setHeaderText(null);</b>
&nbsp;        // Ensure dialog is shown on the JavaFX Application Thread
<b class="nc">&nbsp;        if (javafx.application.Platform.isFxApplicationThread()) {</b>
<b class="nc">&nbsp;             alert.showAndWait();</b>
&nbsp;        } else {
<b class="nc">&nbsp;             javafx.application.Platform.runLater(alert::showAndWait);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    // Main method to launch the JavaFX application.
&nbsp;    public static void main(String[] args) {
<b class="nc">&nbsp;        launch(args);</b>
&nbsp;    }
&nbsp;} 
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-04-19 00:18</div>
</div>
</body>
</html>
